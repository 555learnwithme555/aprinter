// The schema. The value is provided by the build script.
var schema = {"properties":{"_compoundName":{"enum":["editor"],"type":"string","options":{"hidden":true}},"version":{"propertyOrder":0,"enum":[1],"type":"integer","options":{"hidden":true}},"selected_config":{"watch1":{"watch_array":"configurations"},"enumSource":[{"title":"return vars.item[\"name\"];","value":"return vars.item[\"name\"];","sourceTemplate":"if (!vars.watch_array) return []; return vars.watch_array;"}],"type":"string","propertyOrder":1,"title":"Selected configuration (to compile)"},"boards":{"items":{"properties":{"stepper_ports":{"items":{"headerTemplate":"return vars.self[\"Name\"];","required":["_compoundName","Name","DirPin","StepPin","EnablePin","StepperTimer"],"properties":{"Name":{"propertyOrder":0,"type":"string","title":"Name"},"StepperTimer":{"title":"Stepper timer","required":["_compoundName","oc_unit"],"properties":{"_compoundName":{"enum":["interrupt_timer"],"type":"string","options":{"hidden":true}},"oc_unit":{"watch1":{"watch_array":"id_board.platform"},"enumSource":[{"title":"return vars.item[\"value\"];","value":"return vars.item[\"value\"];","sourceTemplate":"if (!vars.watch_array) return []; return vars.watch_array[\"clock\"][\"avail_oc_units\"];"}],"type":"string","propertyOrder":0,"title":"Output compare unit"},"lalal":{"watch1":{"watch_array":"id_board.platform","watch_id":"id_interrupt_timer_choice.oc_unit"},"options":{"derived":true},"template":"if (!vars.watch_array) return null; return aprinter_resolve_ref(vars.watch_array[\"clock\"][\"avail_oc_units\"], \"value\", vars.watch_id);"}},"options":{"collapsed":true},"propertyOrder":4,"additionalProperties":false,"type":"object","id":"id_interrupt_timer_choice"},"_compoundName":{"enum":["stepper_port"],"type":"string","options":{"hidden":true}},"StepPin":{"propertyOrder":2,"type":"string","title":"Step pin"},"EnablePin":{"propertyOrder":3,"type":"string","title":"Enable pin"},"DirPin":{"propertyOrder":1,"type":"string","title":"Direction pin"}},"additionalProperties":false,"title":"Stepper port","type":"object","options":{"collapsed":true}},"type":"array","options":{"disable_collapse":true},"propertyOrder":10,"title":"Stepper ports"},"platform":{"propertyOrder":14,"oneOf":[{"additionalProperties":false,"required":["_compoundName","clock","adc","watchdog","pins"],"type":"object","properties":{"_compoundName":{"enum":["At91Sam3x8e"],"type":"string","options":{"hidden":true}},"watchdog":{"title":"Watchdog","required":["_compoundName","Wdv"],"options":{"collapsed":true},"propertyOrder":2,"additionalProperties":false,"type":"object","properties":{"_compoundName":{"enum":["At91SamWatchdog"],"type":"string","options":{"hidden":true}},"Wdv":{"propertyOrder":0,"type":"integer","title":"Wdv"}}},"pins":{"title":"Pins","required":["_compoundName","input_modes"],"options":{"collapsed":true},"propertyOrder":3,"additionalProperties":false,"type":"object","properties":{"_compoundName":{"enum":["At91SamPins"],"type":"string","options":{"hidden":true}},"input_modes":{"propertyOrder":0,"enum":[[{"ident":"At91SamPinInputModeNormal","name":"Normal"},{"ident":"At91SamPinInputModePullUp","name":"Pull-up"}]],"type":"array","options":{"hidden":true}}}},"adc":{"title":"ADC","required":["_compoundName","freq","avg_interval","smoothing","startup","settling","tracking","transfer"],"options":{"collapsed":true},"propertyOrder":1,"additionalProperties":false,"type":"object","properties":{"settling":{"propertyOrder":4,"type":"integer","title":"Settling time"},"tracking":{"propertyOrder":5,"type":"integer","title":"Tracking time"},"_compoundName":{"enum":["At91SamAdc"],"type":"string","options":{"hidden":true}},"transfer":{"propertyOrder":6,"type":"integer","title":"Transfer time"},"startup":{"propertyOrder":3,"type":"integer","title":"Startup time"},"smoothing":{"propertyOrder":2,"type":"number","title":"Smoothing factor"},"avg_interval":{"propertyOrder":1,"type":"number","title":"Averaging interval"},"freq":{"propertyOrder":0,"type":"number","title":"Frequency"}}},"clock":{"title":"Clock","required":["_compoundName","prescaler","primary_timer","avail_oc_units"],"options":{"collapsed":true},"propertyOrder":0,"additionalProperties":false,"type":"object","properties":{"_compoundName":{"enum":["At91Sam3xClock"],"type":"string","options":{"hidden":true}},"avail_oc_units":{"propertyOrder":2,"enum":[[{"value":"TC0A"},{"value":"TC0B"},{"value":"TC0C"},{"value":"TC1A"},{"value":"TC1B"},{"value":"TC1C"},{"value":"TC2A"},{"value":"TC2B"},{"value":"TC2C"},{"value":"TC3A"},{"value":"TC3B"},{"value":"TC3C"},{"value":"TC4A"},{"value":"TC4B"},{"value":"TC4C"},{"value":"TC5A"},{"value":"TC5B"},{"value":"TC5C"},{"value":"TC6A"},{"value":"TC6B"},{"value":"TC6C"},{"value":"TC7A"},{"value":"TC7B"},{"value":"TC7C"},{"value":"TC8A"},{"value":"TC8B"},{"value":"TC8C"}]],"type":"array","options":{"hidden":true}},"primary_timer":{"propertyOrder":1,"type":"string","title":"Primary timer"},"prescaler":{"propertyOrder":0,"type":"integer","title":"Prescaler"}}}},"title":"At91Sam3x8e"}],"type":"object","options":{"disable_collapse":true},"title":"Platform"},"name":{"propertyOrder":1,"type":"string","title":"Name"},"EventChannelTimer":{"title":"Event channel timer","required":["_compoundName","oc_unit"],"properties":{"_compoundName":{"enum":["interrupt_timer"],"type":"string","options":{"hidden":true}},"oc_unit":{"watch1":{"watch_array":"id_board.platform"},"enumSource":[{"title":"return vars.item[\"value\"];","value":"return vars.item[\"value\"];","sourceTemplate":"if (!vars.watch_array) return []; return vars.watch_array[\"clock\"][\"avail_oc_units\"];"}],"type":"string","propertyOrder":0,"title":"Output compare unit"},"lalal":{"watch1":{"watch_array":"id_board.platform","watch_id":"id_interrupt_timer_choice.oc_unit"},"options":{"derived":true},"template":"if (!vars.watch_array) return null; return aprinter_resolve_ref(vars.watch_array[\"clock\"][\"avail_oc_units\"], \"value\", vars.watch_id);"}},"options":{"collapsed":true},"propertyOrder":9,"additionalProperties":false,"type":"object","id":"id_interrupt_timer_choice"},"_compoundName":{"enum":["board"],"type":"string","options":{"hidden":true}},"pwm_outputs":{"items":{"headerTemplate":"return vars.self[\"Name\"];","required":["_compoundName","Name","Backend"],"properties":{"_compoundName":{"enum":["pwm_output"],"type":"string","options":{"hidden":true}},"Name":{"propertyOrder":0,"type":"string","title":"Name"},"Backend":{"propertyOrder":1,"oneOf":[{"additionalProperties":false,"required":["_compoundName","OutputPin","OutputInvert","PulseInterval","Timer"],"type":"object","properties":{"_compoundName":{"enum":["SoftPwm"],"type":"string","options":{"hidden":true}},"PulseInterval":{"propertyOrder":2,"type":"number","title":"PWM pulse duration"},"OutputPin":{"propertyOrder":0,"type":"string","title":"Output pin"},"Timer":{"title":"Soft PWM Timer","required":["_compoundName","oc_unit"],"properties":{"_compoundName":{"enum":["interrupt_timer"],"type":"string","options":{"hidden":true}},"oc_unit":{"watch1":{"watch_array":"id_board.platform"},"enumSource":[{"title":"return vars.item[\"value\"];","value":"return vars.item[\"value\"];","sourceTemplate":"if (!vars.watch_array) return []; return vars.watch_array[\"clock\"][\"avail_oc_units\"];"}],"type":"string","propertyOrder":0,"title":"Output compare unit"},"lalal":{"watch1":{"watch_array":"id_board.platform","watch_id":"id_interrupt_timer_choice.oc_unit"},"options":{"derived":true},"template":"if (!vars.watch_array) return null; return aprinter_resolve_ref(vars.watch_array[\"clock\"][\"avail_oc_units\"], \"value\", vars.watch_id);"}},"options":{"collapsed":true},"propertyOrder":3,"additionalProperties":false,"type":"object","id":"id_interrupt_timer_choice"},"OutputInvert":{"propertyOrder":1,"enum":[false,true],"type":"boolean","options":{"enum_titles":["Normal (On=High)","Inverted (On=Low)"]},"title":"Output logic"}},"title":"SoftPwm"}],"type":"object","options":{"disable_collapse":true},"title":"Backend"}},"additionalProperties":false,"title":"PWM output","type":"object","options":{"collapsed":true}},"type":"array","options":{"disable_collapse":true},"propertyOrder":13,"title":"PWM outputs"},"sdcard":{"propertyOrder":7,"oneOf":[{"additionalProperties":false,"required":["_compoundName"],"type":"object","properties":{"_compoundName":{"enum":["NoSdCard"],"type":"string","options":{"hidden":true}}},"title":"Disabled"},{"additionalProperties":false,"required":["_compoundName","BufferBaseSize","MaxCommandSize","GcodeParser","SdCardService"],"type":"object","properties":{"_compoundName":{"enum":["SdCard"],"type":"string","options":{"hidden":true}},"MaxCommandSize":{"propertyOrder":1,"type":"integer","title":"Maximum command size"},"GcodeParser":{"propertyOrder":2,"oneOf":[{"additionalProperties":false,"required":["_compoundName","MaxParts"],"type":"object","properties":{"_compoundName":{"enum":["TextGcodeParser"],"type":"string","options":{"hidden":true}},"MaxParts":{"propertyOrder":0,"type":"integer","title":"Maximum number of command parts"}},"title":"Text G-code parser"},{"additionalProperties":false,"required":["_compoundName","MaxParts"],"type":"object","properties":{"_compoundName":{"enum":["BinaryGcodeParser"],"type":"string","options":{"hidden":true}},"MaxParts":{"propertyOrder":0,"type":"integer","title":"Maximum number of command parts"}},"title":"Binary G-code parser"}],"type":"object","title":"G-code parser"},"BufferBaseSize":{"propertyOrder":0,"type":"integer","title":"Buffer size"},"SdCardService":{"propertyOrder":3,"oneOf":[{"additionalProperties":false,"required":["_compoundName","SsPin","SpiService"],"type":"object","properties":{"_compoundName":{"enum":["SpiSdCard"],"type":"string","options":{"hidden":true}},"SsPin":{"propertyOrder":0,"type":"string","title":"SS pin"},"SpiService":{"propertyOrder":1,"oneOf":[{"additionalProperties":false,"required":["_compoundName","Device"],"type":"object","properties":{"_compoundName":{"enum":["At91SamSpi"],"type":"string","options":{"hidden":true}},"Device":{"propertyOrder":0,"type":"string"}},"title":"At91SamSpi"}],"type":"object","options":{"disable_collapse":true},"title":"SPI driver"}},"title":"SPI"}],"type":"object","options":{"collapsed":true},"title":"Driver"}},"title":"Enabled"}],"type":"object","options":{"collapsed":true},"title":"SD card"},"board_for_build":{"propertyOrder":2,"type":"string","title":"Board for building (see nix/boards.nix)"},"config_manager":{"propertyOrder":5,"oneOf":[{"additionalProperties":false,"required":["_compoundName"],"type":"object","properties":{"_compoundName":{"enum":["ConstantConfigManager"],"type":"string","options":{"hidden":true}}},"title":"Disabled"},{"additionalProperties":false,"required":["_compoundName","ConfigStore"],"type":"object","properties":{"_compoundName":{"enum":["RuntimeConfigManager"],"type":"string","options":{"hidden":true}},"ConfigStore":{"propertyOrder":0,"oneOf":[{"additionalProperties":false,"required":["_compoundName"],"type":"object","properties":{"_compoundName":{"enum":["NoStore"],"type":"string","options":{"hidden":true}}},"title":"None"},{"additionalProperties":false,"required":["_compoundName","Eeprom","StartBlock","EndBlock"],"type":"object","properties":{"_compoundName":{"enum":["EepromConfigStore"],"type":"string","options":{"hidden":true}},"StartBlock":{"propertyOrder":1,"type":"integer"},"Eeprom":{"propertyOrder":0,"oneOf":[{"additionalProperties":false,"required":["_compoundName","I2c","I2cAddr","Size","BlockSize","WriteTimeout"],"type":"object","properties":{"_compoundName":{"enum":["I2cEeprom"],"type":"string","options":{"hidden":true}},"BlockSize":{"propertyOrder":3,"type":"integer"},"WriteTimeout":{"propertyOrder":4,"type":"number"},"I2c":{"propertyOrder":0,"oneOf":[{"additionalProperties":false,"required":["_compoundName","Device","Ckdiv","I2cFreq"],"type":"object","properties":{"_compoundName":{"enum":["At91SamI2c"],"type":"string","options":{"hidden":true}},"Device":{"propertyOrder":0,"type":"string"},"Ckdiv":{"propertyOrder":1,"type":"integer"},"I2cFreq":{"propertyOrder":2,"type":"number"}},"title":"At91SamI2c"}],"type":"object","options":{"disable_collapse":true},"title":"I2C backend"},"I2cAddr":{"propertyOrder":1,"type":"integer"},"Size":{"propertyOrder":2,"type":"integer"}},"title":"I2cEeprom"}],"type":"object","options":{"disable_collapse":true},"title":"EEPROM backend"},"EndBlock":{"propertyOrder":2,"type":"integer"}},"title":"EepromConfigStore"}],"type":"object","options":{"disable_collapse":true},"title":"Configuration storage"}},"title":"Enabled"}],"type":"object","options":{"collapsed":true},"title":"Runtime configuration"},"digital_inputs":{"items":{"properties":{"_compoundName":{"enum":["digital_input"],"type":"string","options":{"hidden":true}},"InputMode":{"watch1":{"watch_array":"id_board.platform"},"enumSource":[{"title":"return vars.item[\"name\"];","value":"return vars.item[\"ident\"];","sourceTemplate":"if (!vars.watch_array) return []; return vars.watch_array[\"pins\"][\"input_modes\"];"}],"type":"string","propertyOrder":2,"title":"Input mode"},"Name":{"propertyOrder":0,"type":"string","title":"Name"},"Pin":{"propertyOrder":1,"type":"string","title":"Pin"}},"headerTemplate":"return vars.self[\"Name\"];","required":["_compoundName","Name","Pin","InputMode"],"id":"id_board_digital_inputs","additionalProperties":false,"title":"Digital input","type":"object","options":{"collapsed":true}},"type":"array","options":{"disable_collapse":true},"propertyOrder":11,"title":"Digital inputs"},"board_helper_includes":{"title":"Board helper includes","items":{"type":"string","title":"Name"},"format":"table","propertyOrder":15,"type":"array","options":{"disable_collapse":true}},"performance":{"title":"Performance parameters","required":["_compoundName","MaxStepsPerCycle","StepperSegmentBufferSize","EventChannelBufferSize","LookaheadBufferSize","LookaheadCommitCount","FpType","AxisDriverPrecisionParams","EventChannelTimerClearance"],"options":{"collapsed":true},"propertyOrder":8,"additionalProperties":false,"type":"object","properties":{"EventChannelTimerClearance":{"propertyOrder":7,"type":"number","title":"Event channel timer clearance"},"LookaheadBufferSize":{"propertyOrder":3,"type":"integer","title":"Lookahead buffer size"},"_compoundName":{"enum":["performance"],"type":"string","options":{"hidden":true}},"LookaheadCommitCount":{"propertyOrder":4,"type":"integer","title":"Lookahead commit count"},"FpType":{"propertyOrder":5,"enum":["float","double"],"type":"string"},"MaxStepsPerCycle":{"propertyOrder":0,"type":"number","title":"Max steps per cycle"},"StepperSegmentBufferSize":{"propertyOrder":1,"type":"integer","title":"Stepper segment buffer size"},"AxisDriverPrecisionParams":{"propertyOrder":6,"enum":["AxisDriverAvrPrecisionParams","AxisDriverDuePrecisionParams"],"type":"string","title":"Stepping precision parameters"},"EventChannelBufferSize":{"propertyOrder":2,"type":"integer","title":"Event channel buffer size"}}},"output_type":{"propertyOrder":3,"enum":["hex","bin"],"type":"string","title":"Build output type"},"LedPin":{"propertyOrder":4,"type":"string","title":"LED pin"},"identifier":{"propertyOrder":0,"type":"string","title":"Identifier"},"serial":{"title":"Serial parameters","required":["_compoundName","BaudRate","RecvBufferSizeExp","SendBufferSizeExp","GcodeMaxParts","Service"],"options":{"collapsed":true},"propertyOrder":6,"additionalProperties":false,"type":"object","properties":{"BaudRate":{"propertyOrder":0,"type":"integer","title":"Baud rate"},"Service":{"propertyOrder":4,"oneOf":[{"additionalProperties":false,"required":["_compoundName"],"type":"object","properties":{"_compoundName":{"enum":["AsfUsbSerial"],"type":"string","options":{"hidden":true}}},"title":"AT91 USB"},{"additionalProperties":false,"required":["_compoundName"],"type":"object","properties":{"_compoundName":{"enum":["At91Sam3xSerial"],"type":"string","options":{"hidden":true}}},"title":"AT91 UART"}],"type":"object","options":{"disable_collapse":true},"title":"Backend"},"RecvBufferSizeExp":{"propertyOrder":1,"type":"integer","title":"Receive buffer size (power of two exponent)"},"_compoundName":{"enum":["serial"],"type":"string","options":{"hidden":true}},"GcodeMaxParts":{"propertyOrder":3,"type":"integer","title":"Max parts in GCode command"},"SendBufferSizeExp":{"propertyOrder":2,"type":"integer","title":"Send buffer size (power of two exponent)"}}},"analog_inputs":{"items":{"headerTemplate":"return vars.self[\"Name\"];","required":["_compoundName","Name","Pin"],"properties":{"_compoundName":{"enum":["analog_input"],"type":"string","options":{"hidden":true}},"Name":{"propertyOrder":0,"type":"string","title":"Name"},"Pin":{"propertyOrder":1,"type":"string","title":"Pin"}},"additionalProperties":false,"title":"Analog input","type":"object","options":{"collapsed":true}},"type":"array","options":{"disable_collapse":true},"propertyOrder":12,"title":"Analog inputs"}},"headerTemplate":"return vars.self[\"name\"];","required":["_compoundName","identifier","name","board_for_build","output_type","LedPin","config_manager","serial","sdcard","performance","EventChannelTimer","stepper_ports","digital_inputs","analog_inputs","pwm_outputs","platform","board_helper_includes"],"id":"id_board","additionalProperties":false,"title":"Board","type":"object","options":{"collapsed":true}},"type":"array","propertyOrder":3,"title":"Boards"},"configurations":{"items":{"properties":{"board_id":{"watch1":{"watch_array":"boards"},"enumSource":[{"title":"return vars.item[\"name\"];","value":"return vars.item[\"identifier\"];","sourceTemplate":"if (!vars.watch_array) return []; return vars.watch_array;"}],"type":"string","propertyOrder":1,"title":"Board"},"heaters":{"items":{"properties":{"control":{"title":"Control parameters","required":["_compoundName","ControlInterval","PidP","PidI","PidD","PidIStateMin","PidIStateMax","PidDHistory"],"options":{"collapsed":true},"propertyOrder":8,"additionalProperties":false,"type":"object","properties":{"PidI":{"propertyOrder":2,"type":"number","title":"PID integral factor [1/(Ks)]"},"PidIStateMin":{"propertyOrder":4,"type":"number","title":"PID integral state min [1]"},"ControlInterval":{"propertyOrder":0,"type":"number","title":"Control interval [s]"},"_compoundName":{"enum":["control"],"type":"string","options":{"hidden":true}},"PidD":{"propertyOrder":3,"type":"number","title":"PID derivative factor [s/K]"},"PidP":{"propertyOrder":1,"type":"number","title":"PID proportional factor [1/K]"},"PidIStateMax":{"propertyOrder":5,"type":"number","title":"PID integral state max [1]"},"PidDHistory":{"propertyOrder":6,"type":"number","title":"PID derivative smoothing factor [1]"}}},"conversion":{"title":"Conversion parameters","required":["_compoundName","ResistorR","R0","Beta","MinTemp","MaxTemp"],"options":{"collapsed":true},"propertyOrder":7,"additionalProperties":false,"type":"object","properties":{"MaxTemp":{"propertyOrder":4,"type":"number","title":"Maximum temperature [C]"},"R0":{"propertyOrder":1,"type":"number","title":"Thermistor resistance @25C [ohm]"},"_compoundName":{"enum":["conversion"],"type":"string","options":{"hidden":true}},"MinTemp":{"propertyOrder":3,"type":"number","title":"Minimum temperature [C]"},"Beta":{"propertyOrder":2,"type":"number","title":"Thermistor beta value [K]"},"ResistorR":{"propertyOrder":0,"type":"number","title":"Resistor resistance [ohm]"}}},"WaitMCommand":{"propertyOrder":3,"type":"integer","title":"Wait command M-number"},"Name":{"propertyOrder":0,"type":"string","title":"Name"},"observer":{"title":"Observation parameters","required":["_compoundName","ObserverInterval","ObserverTolerance","ObserverMinTime"],"options":{"collapsed":true},"propertyOrder":9,"additionalProperties":false,"type":"object","properties":{"_compoundName":{"enum":["observer"],"type":"string","options":{"hidden":true}},"ObserverMinTime":{"propertyOrder":2,"type":"number","title":"Observation minimum time [s]"},"ObserverInterval":{"propertyOrder":0,"type":"number","title":"Observation interval [s]"},"ObserverTolerance":{"propertyOrder":1,"type":"number","title":"Observation tolerance [K]"}}},"_compoundName":{"enum":["heater"],"type":"string","options":{"hidden":true}},"MaxSafeTemp":{"propertyOrder":6,"type":"number","title":"Maximum safe temperature [C]"},"pwm_output":{"watch1":{"watch_array":"id_configuration.board_data"},"enumSource":[{"title":"return vars.item[\"Name\"];","value":"return vars.item[\"Name\"];","sourceTemplate":"if (!vars.watch_array) return []; return vars.watch_array[\"pwm_outputs\"];"}],"type":"string","propertyOrder":1,"title":"PWM output"},"SetMCommand":{"propertyOrder":2,"type":"integer","title":"Set command M-number"},"MinSafeTemp":{"propertyOrder":5,"type":"number","title":"Minimum safe temperature [C]"},"ThermistorInput":{"watch1":{"watch_array":"id_configuration.board_data"},"enumSource":[{"title":"return vars.item[\"Name\"];","value":"return vars.item[\"Name\"];","sourceTemplate":"if (!vars.watch_array) return []; return vars.watch_array[\"analog_inputs\"];"}],"type":"string","propertyOrder":4,"title":"Thermistor analog input"}},"headerTemplate":"return vars.self[\"Name\"];","required":["_compoundName","Name","pwm_output","SetMCommand","WaitMCommand","ThermistorInput","MinSafeTemp","MaxSafeTemp","conversion","control","observer"],"id":"id_configuration_heater","additionalProperties":false,"title":"Heater","type":"object","options":{"collapsed":true}},"type":"array","options":{"disable_collapse":true},"propertyOrder":5,"title":"Heaters"},"name":{"propertyOrder":0,"type":"string","title":"Name"},"_compoundName":{"enum":["config"],"type":"string","options":{"hidden":true}},"probe":{"propertyOrder":7,"oneOf":[{"additionalProperties":false,"required":["_compoundName"],"type":"object","properties":{"_compoundName":{"enum":["NoProbe"],"type":"string","options":{"hidden":true}}},"title":"Disabled"},{"title":"Enabled","required":["_compoundName","ProbePin","InvertInput","OffsetX","OffsetY","StartHeight","LowHeight","RetractDist","MoveSpeed","FastSpeed","RetractSpeed","SlowSpeed","ProbePoints"],"id":"id_configuration_probe_probe","additionalProperties":false,"type":"object","properties":{"RetractDist":{"propertyOrder":6,"type":"number","title":"Retraction distance"},"FastSpeed":{"propertyOrder":8,"type":"number","title":"Fast (first) probing speed"},"InvertInput":{"propertyOrder":1,"enum":[false,true],"type":"boolean","options":{"enum_titles":["No","Yes"]},"title":"Invert input"},"RetractSpeed":{"propertyOrder":9,"type":"number","title":"Retraction speed"},"_compoundName":{"enum":["Probe"],"type":"string","options":{"hidden":true}},"SlowSpeed":{"propertyOrder":10,"type":"number","title":"Slow (second) probing speed"},"OffsetX":{"propertyOrder":2,"type":"number","title":"Probe offset (X)"},"OffsetY":{"propertyOrder":3,"type":"number","title":"Probe offset (Y)"},"MoveSpeed":{"propertyOrder":7,"type":"number","title":"Speed for moving to probe points"},"LowHeight":{"propertyOrder":5,"type":"number","title":"Minimum Z to move down to"},"ProbePin":{"watch1":{"watch_array":"id_configuration.board_data"},"enumSource":[{"title":"return vars.item[\"Name\"];","value":"return vars.item[\"Name\"];","sourceTemplate":"if (!vars.watch_array) return []; return vars.watch_array[\"digital_inputs\"];"}],"type":"string","propertyOrder":0,"title":"Probe pin"},"ProbePoints":{"items":{"additionalProperties":false,"required":["_compoundName","X","Y"],"type":"object","properties":{"_compoundName":{"enum":["ProbePoint"],"type":"string","options":{"hidden":true}},"X":{"propertyOrder":0,"type":"number"},"Y":{"propertyOrder":1,"type":"number"}},"title":"Probe point"},"type":"array","propertyOrder":11,"title":"Probe points"},"StartHeight":{"propertyOrder":4,"type":"number","title":"Starting Z for probing a point"}}}],"type":"object","options":{"collapsed":true},"title":"Bed probing"},"fans":{"items":{"properties":{"_compoundName":{"enum":["fan"],"type":"string","options":{"hidden":true}},"OffMCommand":{"propertyOrder":3,"type":"integer","title":"Off command M-number"},"Name":{"propertyOrder":0,"type":"string","title":"Name"},"pwm_output":{"watch1":{"watch_array":"id_configuration.board_data"},"enumSource":[{"title":"return vars.item[\"Name\"];","value":"return vars.item[\"Name\"];","sourceTemplate":"if (!vars.watch_array) return []; return vars.watch_array[\"pwm_outputs\"];"}],"type":"string","propertyOrder":1,"title":"PWM output"},"SetMCommand":{"propertyOrder":2,"type":"integer","title":"Set command M-number"}},"headerTemplate":"return vars.self[\"Name\"];","required":["_compoundName","Name","pwm_output","SetMCommand","OffMCommand"],"id":"id_configuration_fan","additionalProperties":false,"title":"Fan","type":"object","options":{"collapsed":true}},"type":"array","options":{"disable_collapse":true},"propertyOrder":6,"title":"Fans"},"InactiveTime":{"propertyOrder":2,"type":"number","title":"Inactive time"},"steppers":{"items":{"properties":{"InvertDir":{"propertyOrder":2,"enum":[false,true],"type":"boolean","options":{"enum_titles":["No","Yes"]},"title":"Invert direction"},"StepsPerUnit":{"propertyOrder":3,"type":"number","title":"Steps per unit"},"DistanceFactor":{"propertyOrder":8,"type":"number","title":"Distance factor"},"MaxSpeed":{"propertyOrder":6,"type":"number","title":"Maximum speed"},"MinPos":{"propertyOrder":4,"type":"number","title":"Minimum position"},"Name":{"propertyOrder":0,"type":"string","title":"Name"},"_compoundName":{"enum":["stepper"],"type":"string","options":{"hidden":true}},"homing":{"propertyOrder":11,"oneOf":[{"additionalProperties":false,"required":["_compoundName"],"type":"object","properties":{"_compoundName":{"enum":["no_homing"],"type":"string","options":{"hidden":true}}},"title":"Disabled"},{"title":"Enabled","required":["_compoundName","HomeDir","HomeEndstopInput","HomeEndInvert","HomeFastMaxDist","HomeRetractDist","HomeSlowMaxDist","HomeFastSpeed","HomeRetractSpeed","HomeSlowSpeed"],"id":"id_board_steppers_homing","additionalProperties":false,"type":"object","properties":{"HomeEndstopInput":{"watch1":{"watch_array":"id_configuration.board_data"},"enumSource":[{"title":"return vars.item[\"Name\"];","value":"return vars.item[\"Name\"];","sourceTemplate":"if (!vars.watch_array) return []; return vars.watch_array[\"digital_inputs\"];"}],"type":"string","propertyOrder":1,"title":"Endstop digital input"},"HomeDir":{"propertyOrder":0,"enum":[false,true],"type":"boolean","options":{"enum_titles":["Negative","Positive"]},"title":"Homing direction"},"_compoundName":{"enum":["homing"],"type":"string","options":{"hidden":true}},"HomeFastMaxDist":{"propertyOrder":3,"type":"number","title":"Maximum fast (initial) travel"},"HomeSlowMaxDist":{"propertyOrder":5,"type":"number","title":"Maximum slow (after retraction) travel"},"HomeSlowSpeed":{"propertyOrder":8,"type":"number","title":"Slow speed"},"HomeEndInvert":{"propertyOrder":2,"enum":[false,true],"type":"boolean","options":{"enum_titles":["No","Yes"]},"title":"Invert endstop"},"HomeFastSpeed":{"propertyOrder":6,"type":"number","title":"Fast speed"},"HomeRetractSpeed":{"propertyOrder":7,"type":"number","title":"Retraction speed"},"HomeRetractDist":{"propertyOrder":4,"type":"number","title":"Retraction travel"}}}],"type":"object","options":{"collapsed":true},"title":"Homing"},"MaxAccel":{"propertyOrder":7,"type":"number","title":"Maximum acceleration"},"CorneringDistance":{"propertyOrder":9,"type":"number","title":"Cornering distance"},"EnableCartesianSpeedLimit":{"propertyOrder":10,"enum":[false,true],"type":"boolean","options":{"enum_titles":["No","Yes"]},"title":"Is cartesian"},"MaxPos":{"propertyOrder":5,"type":"number","title":"Maximum position"},"stepper_port":{"watch1":{"watch_array":"id_configuration.board_data"},"enumSource":[{"title":"return vars.item[\"Name\"];","value":"return vars.item[\"Name\"];","sourceTemplate":"if (!vars.watch_array) return []; return vars.watch_array[\"stepper_ports\"];"}],"type":"string","propertyOrder":1,"title":"Stepper port"}},"headerTemplate":"return vars.self[\"Name\"];","required":["_compoundName","Name","stepper_port","InvertDir","StepsPerUnit","MinPos","MaxPos","MaxSpeed","MaxAccel","DistanceFactor","CorneringDistance","EnableCartesianSpeedLimit","homing"],"id":"id_configuration_stepper","additionalProperties":false,"title":"Stepper","type":"object","options":{"collapsed":true}},"type":"array","options":{"disable_collapse":true},"propertyOrder":4,"title":"Steppers"},"advanced":{"title":"Advanced parameters","required":["_compoundName","LedBlinkInterval","ForceTimeout"],"options":{"collapsed":true},"propertyOrder":3,"additionalProperties":false,"type":"object","properties":{"_compoundName":{"enum":["advanced"],"type":"string","options":{"hidden":true}},"LedBlinkInterval":{"propertyOrder":0,"type":"number","title":"LED blink interval"},"ForceTimeout":{"propertyOrder":1,"type":"number","title":"Force timeout"}}},"board_data":{"watch1":{"watch_array":"boards","watch_id":"id_configuration.board_id"},"options":{"derived":true},"template":"if (!vars.watch_array) return null; return aprinter_resolve_ref(vars.watch_array, \"identifier\", vars.watch_id);"}},"headerTemplate":"return vars.self[\"name\"];","required":["_compoundName","name","board_id","InactiveTime","advanced","steppers","heaters","fans","probe"],"id":"id_configuration","additionalProperties":false,"title":"Configuration","type":"object","options":{"collapsed":true}},"type":"array","propertyOrder":2,"title":"Configurations"}},"title":"Configuration editor","required":["_compoundName","version","selected_config","configurations","boards"],"id":"id_editor","additionalProperties":false,"type":"object","options":{"no_header":true,"disable_collapse":true}};

// The default configuration.
var default_config = {"_compoundName":"editor","version":1,"selected_config":"RADDS example","configurations":[{"board_id":"radds","heaters":[{"control":{"PidI":0.0006,"PidIStateMin":0,"ControlInterval":0.2,"_compoundName":"control","PidD":0.17,"PidP":0.047,"PidIStateMax":0.6,"PidDHistory":0.7},"conversion":{"MaxTemp":300,"R0":100000,"_compoundName":"conversion","MinTemp":10,"Beta":3960,"ResistorR":4700},"WaitMCommand":109,"Name":"T","observer":{"_compoundName":"observer","ObserverMinTime":3,"ObserverInterval":0.5,"ObserverTolerance":3},"_compoundName":"heater","MaxSafeTemp":280,"pwm_output":"FET6 (extruder 1)","SetMCommand":104,"MinSafeTemp":15,"ThermistorInput":"T0"},{"control":{"PidI":0.012,"PidIStateMin":0,"ControlInterval":0.3,"_compoundName":"control","PidD":2.5,"PidP":1,"PidIStateMax":1,"PidDHistory":0.8},"conversion":{"MaxTemp":150,"R0":10000,"_compoundName":"conversion","MinTemp":10,"Beta":3480,"ResistorR":4700},"WaitMCommand":190,"Name":"B","observer":{"_compoundName":"observer","ObserverMinTime":3,"ObserverInterval":0.5,"ObserverTolerance":1.5},"_compoundName":"heater","MaxSafeTemp":120,"pwm_output":"FET1 (bed)","SetMCommand":140,"MinSafeTemp":15,"ThermistorInput":"T4"},{"control":{"PidI":0.0006,"PidIStateMin":0,"ControlInterval":0.2,"_compoundName":"control","PidD":0.17,"PidP":0.047,"PidIStateMax":0.6,"PidDHistory":0.7},"conversion":{"MaxTemp":300,"R0":100000,"_compoundName":"conversion","MinTemp":10,"Beta":3960,"ResistorR":4700},"WaitMCommand":409,"Name":"U","observer":{"_compoundName":"observer","ObserverMinTime":5,"ObserverInterval":0.5,"ObserverTolerance":5},"_compoundName":"heater","MaxSafeTemp":280,"pwm_output":"FET5 (extruder 2)","SetMCommand":404,"MinSafeTemp":15,"ThermistorInput":"T1"}],"name":"RADDS example","_compoundName":"config","probe":{"RetractDist":1,"FastSpeed":2,"InvertInput":false,"RetractSpeed":3,"_compoundName":"Probe","SlowSpeed":0.6,"OffsetX":-18,"OffsetY":-31,"MoveSpeed":120,"LowHeight":2,"ProbePin":"Z-MAX","ProbePoints":[{"_compoundName":"ProbePoint","X":0,"Y":31},{"_compoundName":"ProbePoint","X":0,"Y":155},{"_compoundName":"ProbePoint","X":205,"Y":31},{"_compoundName":"ProbePoint","X":205,"Y":155}],"StartHeight":9},"fans":[{"_compoundName":"fan","OffMCommand":107,"Name":"E","pwm_output":"FET3 (fan 1)","SetMCommand":106},{"_compoundName":"fan","OffMCommand":407,"Name":"U","pwm_output":"FET2 (fan 2)","SetMCommand":406}],"InactiveTime":480,"steppers":[{"InvertDir":false,"StepsPerUnit":160,"DistanceFactor":1,"MaxSpeed":300,"MinPos":-53,"Name":"X","_compoundName":"stepper","EnableCartesianSpeedLimit":true,"MaxAccel":1500,"CorneringDistance":40,"homing":{"HomeEndstopInput":"X-MIN","HomeDir":false,"_compoundName":"homing","HomeFastMaxDist":280,"HomeSlowMaxDist":5,"HomeSlowSpeed":5,"HomeRetractSpeed":50,"HomeFastSpeed":40,"HomeRetractDist":3,"HomeEndInvert":false},"MaxPos":210,"stepper_port":"X"},{"InvertDir":false,"StepsPerUnit":160,"DistanceFactor":1,"MaxSpeed":300,"MinPos":0,"Name":"Y","_compoundName":"stepper","EnableCartesianSpeedLimit":true,"MaxAccel":650,"CorneringDistance":40,"homing":{"HomeEndstopInput":"Y-MIN","HomeDir":false,"_compoundName":"homing","HomeFastMaxDist":200,"HomeSlowMaxDist":5,"HomeSlowSpeed":5,"HomeRetractSpeed":50,"HomeFastSpeed":40,"HomeRetractDist":3,"HomeEndInvert":false},"MaxPos":157,"stepper_port":"Y"},{"InvertDir":true,"StepsPerUnit":8000,"DistanceFactor":1,"MaxSpeed":3,"MinPos":0,"Name":"Z","_compoundName":"stepper","EnableCartesianSpeedLimit":true,"MaxAccel":30,"CorneringDistance":40,"homing":{"HomeEndstopInput":"Z-MIN","HomeDir":false,"_compoundName":"homing","HomeFastMaxDist":101,"HomeSlowMaxDist":1.2,"HomeSlowSpeed":0.6,"HomeRetractSpeed":2,"HomeFastSpeed":2,"HomeRetractDist":0.8,"HomeEndInvert":false},"MaxPos":100,"stepper_port":"Z"},{"InvertDir":false,"StepsPerUnit":1856,"DistanceFactor":1,"MaxSpeed":45,"MinPos":-40000,"Name":"E","_compoundName":"stepper","EnableCartesianSpeedLimit":false,"MaxAccel":250,"CorneringDistance":40,"homing":{"_compoundName":"no_homing"},"MaxPos":40000,"stepper_port":"E1"},{"InvertDir":false,"StepsPerUnit":1320,"DistanceFactor":1,"MaxSpeed":45,"MinPos":-40000,"Name":"U","_compoundName":"stepper","EnableCartesianSpeedLimit":false,"MaxAccel":250,"CorneringDistance":40,"homing":{"_compoundName":"no_homing"},"MaxPos":40000,"stepper_port":"E2"}],"advanced":{"_compoundName":"advanced","LedBlinkInterval":0.5,"ForceTimeout":0.1},"board_data":{"config_manager":{"_compoundName":"RuntimeConfigManager","ConfigStore":{"_compoundName":"EepromConfigStore","StartBlock":0,"Eeprom":{"_compoundName":"I2cEeprom","BlockSize":64,"WriteTimeout":1,"I2c":{"_compoundName":"At91SamI2c","Device":"At91SamI2cDevice1","Ckdiv":2,"I2cFreq":100000},"I2cAddr":80,"Size":32768},"EndBlock":512}},"identifier":"radds","name":"RADDS","_compoundName":"board","output_type":"bin","pwm_outputs":[{"_compoundName":"pwm_output","Name":"FET1 (bed)","Backend":{"_compoundName":"SoftPwm","PulseInterval":0.3,"OutputPin":"DuePin7","Timer":{"_compoundName":"interrupt_timer","oc_unit":"TC7A","lalal":{"value":"TC7A"}},"OutputInvert":false}},{"_compoundName":"pwm_output","Name":"FET6 (extruder 1)","Backend":{"_compoundName":"SoftPwm","PulseInterval":0.2,"OutputPin":"DuePin13","Timer":{"_compoundName":"interrupt_timer","oc_unit":"TC7B","lalal":{"value":"TC7B"}},"OutputInvert":false}},{"_compoundName":"pwm_output","Name":"FET5 (extruder 2)","Backend":{"_compoundName":"SoftPwm","PulseInterval":0.2,"OutputPin":"DuePin12","Timer":{"_compoundName":"interrupt_timer","oc_unit":"TC7C","lalal":{"value":"TC7C"}},"OutputInvert":false}},{"_compoundName":"pwm_output","Name":"FET4 (extruder 3)","Backend":{"_compoundName":"SoftPwm","PulseInterval":0.2,"OutputPin":"DuePin11","Timer":{"_compoundName":"interrupt_timer","oc_unit":"TC8A","lalal":{"value":"TC8A"}},"OutputInvert":false}},{"_compoundName":"pwm_output","Name":"FET3 (fan 1)","Backend":{"_compoundName":"SoftPwm","PulseInterval":0.04,"OutputPin":"DuePin9","Timer":{"_compoundName":"interrupt_timer","oc_unit":"TC8B","lalal":{"value":"TC8B"}},"OutputInvert":false}},{"_compoundName":"pwm_output","Name":"FET2 (fan 2)","Backend":{"_compoundName":"SoftPwm","PulseInterval":0.04,"OutputPin":"DuePin8","Timer":{"_compoundName":"interrupt_timer","oc_unit":"TC8C","lalal":{"value":"TC8C"}},"OutputInvert":false}}],"sdcard":{"_compoundName":"SdCard","BufferBaseSize":2048,"GcodeParser":{"_compoundName":"TextGcodeParser","MaxParts":8},"MaxCommandSize":256,"SdCardService":{"_compoundName":"SpiSdCard","SsPin":"DuePin4","SpiService":{"_compoundName":"At91SamSpi","Device":"At91Sam3xSpiDevice"}}},"board_for_build":"arduino_due","platform":{"_compoundName":"At91Sam3x8e","watchdog":{"_compoundName":"At91SamWatchdog","Wdv":260},"pins":{"_compoundName":"At91SamPins","input_modes":[{"ident":"At91SamPinInputModeNormal","name":"Normal"},{"ident":"At91SamPinInputModePullUp","name":"Pull-up"}]},"adc":{"settling":3,"tracking":0,"_compoundName":"At91SamAdc","transfer":1,"startup":8,"smoothing":0.95,"avg_interval":0.0025,"freq":1000000},"clock":{"_compoundName":"At91Sam3xClock","avail_oc_units":[{"value":"TC0A"},{"value":"TC0B"},{"value":"TC0C"},{"value":"TC1A"},{"value":"TC1B"},{"value":"TC1C"},{"value":"TC2A"},{"value":"TC2B"},{"value":"TC2C"},{"value":"TC3A"},{"value":"TC3B"},{"value":"TC3C"},{"value":"TC4A"},{"value":"TC4B"},{"value":"TC4C"},{"value":"TC5A"},{"value":"TC5B"},{"value":"TC5C"},{"value":"TC6A"},{"value":"TC6B"},{"value":"TC6C"},{"value":"TC7A"},{"value":"TC7B"},{"value":"TC7C"},{"value":"TC8A"},{"value":"TC8B"},{"value":"TC8C"}],"primary_timer":"TC0","prescaler":3}},"digital_inputs":[{"_compoundName":"digital_input","InputMode":"At91SamPinInputModePullUp","Name":"X-MIN","Pin":"DuePin28"},{"_compoundName":"digital_input","InputMode":"At91SamPinInputModePullUp","Name":"Y-MIN","Pin":"DuePin30"},{"_compoundName":"digital_input","InputMode":"At91SamPinInputModePullUp","Name":"Z-MIN","Pin":"DuePin32"},{"_compoundName":"digital_input","InputMode":"At91SamPinInputModePullUp","Name":"X-MAX","Pin":"DuePin34"},{"_compoundName":"digital_input","InputMode":"At91SamPinInputModePullUp","Name":"Y-MAX","Pin":"DuePin36"},{"_compoundName":"digital_input","InputMode":"At91SamPinInputModePullUp","Name":"Z-MAX","Pin":"DuePin38"}],"board_helper_includes":["arduino_due_pins"],"performance":{"LookaheadCommitCount":10,"LookaheadBufferSize":28,"_compoundName":"performance","EventChannelTimerClearance":0.002,"FpType":"double","MaxStepsPerCycle":0.0017,"StepperSegmentBufferSize":32,"AxisDriverPrecisionParams":"AxisDriverDuePrecisionParams","EventChannelBufferSize":32},"EventChannelTimer":{"_compoundName":"interrupt_timer","oc_unit":"TC0A"},"LedPin":"DuePin37","stepper_ports":[{"Name":"X","StepperTimer":{"_compoundName":"interrupt_timer","oc_unit":"TC1A","lalal":{"value":"TC1A"}},"_compoundName":"stepper_port","StepPin":"DuePin24","EnablePin":"DuePin26","DirPin":"DuePin23"},{"Name":"Y","StepperTimer":{"_compoundName":"interrupt_timer","oc_unit":"TC2A","lalal":{"value":"TC2A"}},"_compoundName":"stepper_port","StepPin":"DuePin17","EnablePin":"DuePin22","DirPin":"DuePin16"},{"Name":"Z","StepperTimer":{"_compoundName":"interrupt_timer","oc_unit":"TC3A","lalal":{"value":"TC3A"}},"_compoundName":"stepper_port","StepPin":"DuePin2","EnablePin":"DuePin15","DirPin":"DuePin3"},{"Name":"E1","StepperTimer":{"_compoundName":"interrupt_timer","oc_unit":"TC4A","lalal":{"value":"TC4A"}},"_compoundName":"stepper_port","StepPin":"DuePinA7","EnablePin":"DuePinA8","DirPin":"DuePinA6"},{"Name":"E2","StepperTimer":{"_compoundName":"interrupt_timer","oc_unit":"TC5A","lalal":{"value":"TC5A"}},"_compoundName":"stepper_port","StepPin":"DuePinA10","EnablePin":"DuePinA11","DirPin":"DuePinA9"},{"Name":"E3","StepperTimer":{"_compoundName":"interrupt_timer","oc_unit":"TC6A","lalal":{"value":"TC6A"}},"_compoundName":"stepper_port","StepPin":"DuePin51","EnablePin":"DuePin49","DirPin":"DuePin53"}],"serial":{"BaudRate":115200,"Service":{"_compoundName":"AsfUsbSerial"},"RecvBufferSizeExp":8,"_compoundName":"serial","GcodeMaxParts":16,"SendBufferSizeExp":9},"analog_inputs":[{"_compoundName":"analog_input","Name":"T0","Pin":"DuePinA0"},{"_compoundName":"analog_input","Name":"T1","Pin":"DuePinA1"},{"_compoundName":"analog_input","Name":"T2","Pin":"DuePinA2"},{"_compoundName":"analog_input","Name":"T3","Pin":"DuePinA3"},{"_compoundName":"analog_input","Name":"T4","Pin":"DuePinA4"}]}}],"boards":[{"config_manager":{"_compoundName":"RuntimeConfigManager","ConfigStore":{"_compoundName":"EepromConfigStore","StartBlock":0,"Eeprom":{"_compoundName":"I2cEeprom","BlockSize":64,"WriteTimeout":1,"I2c":{"_compoundName":"At91SamI2c","Device":"At91SamI2cDevice1","Ckdiv":2,"I2cFreq":100000},"I2cAddr":80,"Size":32768},"EndBlock":512}},"identifier":"radds","name":"RADDS","_compoundName":"board","output_type":"bin","pwm_outputs":[{"_compoundName":"pwm_output","Name":"FET1 (bed)","Backend":{"_compoundName":"SoftPwm","PulseInterval":0.3,"OutputPin":"DuePin7","Timer":{"_compoundName":"interrupt_timer","oc_unit":"TC7A","lalal":{"value":"TC7A"}},"OutputInvert":false}},{"_compoundName":"pwm_output","Name":"FET6 (extruder 1)","Backend":{"_compoundName":"SoftPwm","PulseInterval":0.2,"OutputPin":"DuePin13","Timer":{"_compoundName":"interrupt_timer","oc_unit":"TC7B","lalal":{"value":"TC7B"}},"OutputInvert":false}},{"_compoundName":"pwm_output","Name":"FET5 (extruder 2)","Backend":{"_compoundName":"SoftPwm","PulseInterval":0.2,"OutputPin":"DuePin12","Timer":{"_compoundName":"interrupt_timer","oc_unit":"TC7C","lalal":{"value":"TC7C"}},"OutputInvert":false}},{"_compoundName":"pwm_output","Name":"FET4 (extruder 3)","Backend":{"_compoundName":"SoftPwm","PulseInterval":0.2,"OutputPin":"DuePin11","Timer":{"_compoundName":"interrupt_timer","oc_unit":"TC8A","lalal":{"value":"TC8A"}},"OutputInvert":false}},{"_compoundName":"pwm_output","Name":"FET3 (fan 1)","Backend":{"_compoundName":"SoftPwm","PulseInterval":0.04,"OutputPin":"DuePin9","Timer":{"_compoundName":"interrupt_timer","oc_unit":"TC8B","lalal":{"value":"TC8B"}},"OutputInvert":false}},{"_compoundName":"pwm_output","Name":"FET2 (fan 2)","Backend":{"_compoundName":"SoftPwm","PulseInterval":0.04,"OutputPin":"DuePin8","Timer":{"_compoundName":"interrupt_timer","oc_unit":"TC8C","lalal":{"value":"TC8C"}},"OutputInvert":false}}],"sdcard":{"_compoundName":"SdCard","BufferBaseSize":2048,"GcodeParser":{"_compoundName":"TextGcodeParser","MaxParts":8},"MaxCommandSize":256,"SdCardService":{"_compoundName":"SpiSdCard","SsPin":"DuePin4","SpiService":{"_compoundName":"At91SamSpi","Device":"At91Sam3xSpiDevice"}}},"board_for_build":"arduino_due","platform":{"_compoundName":"At91Sam3x8e","watchdog":{"_compoundName":"At91SamWatchdog","Wdv":260},"pins":{"_compoundName":"At91SamPins","input_modes":[{"ident":"At91SamPinInputModeNormal","name":"Normal"},{"ident":"At91SamPinInputModePullUp","name":"Pull-up"}]},"adc":{"settling":3,"tracking":0,"_compoundName":"At91SamAdc","transfer":1,"startup":8,"smoothing":0.95,"avg_interval":0.0025,"freq":1000000},"clock":{"_compoundName":"At91Sam3xClock","avail_oc_units":[{"value":"TC0A"},{"value":"TC0B"},{"value":"TC0C"},{"value":"TC1A"},{"value":"TC1B"},{"value":"TC1C"},{"value":"TC2A"},{"value":"TC2B"},{"value":"TC2C"},{"value":"TC3A"},{"value":"TC3B"},{"value":"TC3C"},{"value":"TC4A"},{"value":"TC4B"},{"value":"TC4C"},{"value":"TC5A"},{"value":"TC5B"},{"value":"TC5C"},{"value":"TC6A"},{"value":"TC6B"},{"value":"TC6C"},{"value":"TC7A"},{"value":"TC7B"},{"value":"TC7C"},{"value":"TC8A"},{"value":"TC8B"},{"value":"TC8C"}],"primary_timer":"TC0","prescaler":3}},"digital_inputs":[{"_compoundName":"digital_input","InputMode":"At91SamPinInputModePullUp","Name":"X-MIN","Pin":"DuePin28"},{"_compoundName":"digital_input","InputMode":"At91SamPinInputModePullUp","Name":"Y-MIN","Pin":"DuePin30"},{"_compoundName":"digital_input","InputMode":"At91SamPinInputModePullUp","Name":"Z-MIN","Pin":"DuePin32"},{"_compoundName":"digital_input","InputMode":"At91SamPinInputModePullUp","Name":"X-MAX","Pin":"DuePin34"},{"_compoundName":"digital_input","InputMode":"At91SamPinInputModePullUp","Name":"Y-MAX","Pin":"DuePin36"},{"_compoundName":"digital_input","InputMode":"At91SamPinInputModePullUp","Name":"Z-MAX","Pin":"DuePin38"}],"board_helper_includes":["arduino_due_pins"],"performance":{"LookaheadCommitCount":10,"LookaheadBufferSize":28,"_compoundName":"performance","EventChannelTimerClearance":0.002,"FpType":"double","MaxStepsPerCycle":0.0017,"StepperSegmentBufferSize":32,"AxisDriverPrecisionParams":"AxisDriverDuePrecisionParams","EventChannelBufferSize":32},"EventChannelTimer":{"_compoundName":"interrupt_timer","oc_unit":"TC0A"},"LedPin":"DuePin37","stepper_ports":[{"Name":"X","StepperTimer":{"_compoundName":"interrupt_timer","oc_unit":"TC1A","lalal":{"value":"TC1A"}},"_compoundName":"stepper_port","StepPin":"DuePin24","EnablePin":"DuePin26","DirPin":"DuePin23"},{"Name":"Y","StepperTimer":{"_compoundName":"interrupt_timer","oc_unit":"TC2A","lalal":{"value":"TC2A"}},"_compoundName":"stepper_port","StepPin":"DuePin17","EnablePin":"DuePin22","DirPin":"DuePin16"},{"Name":"Z","StepperTimer":{"_compoundName":"interrupt_timer","oc_unit":"TC3A","lalal":{"value":"TC3A"}},"_compoundName":"stepper_port","StepPin":"DuePin2","EnablePin":"DuePin15","DirPin":"DuePin3"},{"Name":"E1","StepperTimer":{"_compoundName":"interrupt_timer","oc_unit":"TC4A","lalal":{"value":"TC4A"}},"_compoundName":"stepper_port","StepPin":"DuePinA7","EnablePin":"DuePinA8","DirPin":"DuePinA6"},{"Name":"E2","StepperTimer":{"_compoundName":"interrupt_timer","oc_unit":"TC5A","lalal":{"value":"TC5A"}},"_compoundName":"stepper_port","StepPin":"DuePinA10","EnablePin":"DuePinA11","DirPin":"DuePinA9"},{"Name":"E3","StepperTimer":{"_compoundName":"interrupt_timer","oc_unit":"TC6A","lalal":{"value":"TC6A"}},"_compoundName":"stepper_port","StepPin":"DuePin51","EnablePin":"DuePin49","DirPin":"DuePin53"}],"serial":{"BaudRate":115200,"Service":{"_compoundName":"AsfUsbSerial"},"RecvBufferSizeExp":8,"_compoundName":"serial","GcodeMaxParts":16,"SendBufferSizeExp":9},"analog_inputs":[{"_compoundName":"analog_input","Name":"T0","Pin":"DuePinA0"},{"_compoundName":"analog_input","Name":"T1","Pin":"DuePinA1"},{"_compoundName":"analog_input","Name":"T2","Pin":"DuePinA2"},{"_compoundName":"analog_input","Name":"T3","Pin":"DuePinA3"},{"_compoundName":"analog_input","Name":"T4","Pin":"DuePinA4"}]}]};

// Divs/textareas on the page
var $editor = document.getElementById('editor');

// Buttons and other stuff
var $save_data_button = document.getElementById('save_data');
var $reload_data_button = document.getElementById('reload_data');
var $load_defaults_button = document.getElementById('load_defaults');
var $export_data_button = document.getElementById('export_data');
var $import_data_button = document.getElementById('import_data');
var $import_data_file_input = document.getElementById('import_data_file');
var $compile_start_button = document.getElementById('compile_start');

// Global variables.
var jsoneditor;

// Helper functions for resolving references within the editor.
function aprinter_resolve_ref(target_arr, target_id_field, target_id) {
    for (var index in target_arr) {
        var target = target_arr[index];
        if (target[target_id_field] == target_id) {
            return target;
        }
    }
    return null;
}

// Function to get config from local storage or default.
function get_config(allow_default) {
    var config_json = localStorage.getItem("aprinter_config");
    if (!config_json) {
        if (allow_default) {
            return {ok: true, value: default_config};
        }
        return {ok: false};
    }
    var config_value = JSON.parse(config_json);
    return {ok: true, value: config_value};
}

function set_compile_status(running) {
    $compile_start_button.disabled = running;
    
    var elems = document.getElementsByClassName("compile_progress");
    for (var i = 0; i < elems.length; i++) {
        elems[i].style.visibility = running ? "visible" : "hidden";
    }
}

function base64_to_blob(input, content_type) {
    var str = window.atob(input);
    var ab = new ArrayBuffer(str.length);
    var ia = new Uint8Array(ab);
    for (var i = 0; i < str.length; i++) {
        ia[i] = str.charCodeAt(i);
    }
    return new Blob([ia], {type: content_type});
}

var load = function() {
    // Get initial configuration from local storage, if any.
    var startval = get_config(true).value;

    // Create the editor.
    jsoneditor = new JSONEditor($editor, {
        schema: schema,
        startval: startval,
        disable_edit_json: true,
        disable_properties: true,
        template: "javascript",
        theme: "bootstrap3",
        iconlib: "bootstrap3"
    });
    
    // When the save button is pressed, save the config data to local storage.
    $save_data_button.addEventListener('click', function() {
        var config_json = JSON.stringify(jsoneditor.getValue());
        localStorage.setItem("aprinter_config", config_json);
    });
    
    // When the reload button is pressed, load the config data from local storage.
    $reload_data_button.addEventListener('click', function() {
        var get_config_res = get_config(false);
        if (!get_config_res.ok) {
            alert("Cannot load - no configuration present in local storage!");
            return;
        }
        jsoneditor.setValue(get_config_res.value);
    });
    
    // When the load-defaults button is pressed, load the default config.
    $load_defaults_button.addEventListener('click', function() {
        jsoneditor.setValue(default_config);
    });
    
    // If the window is about to be closed with unsaved data, ask for confirmation.
    window.onbeforeunload = function (evt) {
        if (JSON.stringify(get_config(true).value) == JSON.stringify(jsoneditor.getValue())) {
            return null;
        }
        var message = 'APrinter Configuration: There are unsaved configuration changes!';
        if (typeof evt == 'undefined') {
            evt = window.event;
        }
        if (evt) {
            evt.returnValue = message;
        }
        return message;
    }
    
    // When the export button is pressed, trigger downloading of the configuration dump.
    $export_data_button.addEventListener('click', function() {
        var config_json = JSON.stringify(jsoneditor.getValue());
        var blob = new Blob([config_json], {type: 'application/json;charset=utf-8'});
        saveAs(blob, 'aprinter_config.json')
    });
    
    // Import button handler.
    $import_data_button.addEventListener('click', function() {
        if (!$import_data_file_input.files[0]) {
            alert('Please select a configuration file to import.');
            return;
        }
        var reader = new FileReader();
        reader.onload = function() {
            var config = JSON.parse(this.result);
            jsoneditor.setValue(config);
        }
        reader.readAsText($import_data_file_input.files[0]);
    });
    
    // Compile button handler.
    $compile_start_button.addEventListener('click', function() {
        var compile_request = new XMLHttpRequest();
        compile_request.open("POST", "/compile", true);
        compile_request.setRequestHeader("Content-type", "application/json; charset=utf-8")
        
        compile_request.onreadystatechange = function() {
            if (compile_request.readyState == 4) {
                set_compile_status(false);
                
                if (compile_request.status != 200) {
                    alert("Compilation failed (request error)!");
                } else {
                    var result = JSON.parse(compile_request.responseText);
                    if (!result.success) {
                        alert("Compilation failed (compile error)!");
                    } else {
                        var blob = base64_to_blob(result.data, 'application/octet-stream');
                        saveAs(blob, result.filename)
                    }
                }
            }
        }
        
        compile_request.send(JSON.stringify(jsoneditor.getValue()));
        
        set_compile_status(true);
    });
}

load();
