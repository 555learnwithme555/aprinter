// The schema. The value is provided by the build script.
var schema = {"additionalProperties":false,"id":"id_editor","options":{"disable_collapse":true,"no_header":true},"properties":{"_compoundName":{"enum":["editor"],"options":{"hidden":true},"type":"string"},"boards":{"items":{"additionalProperties":false,"headerTemplate":"return vars.self[\"name\"];","id":"id_board","options":{"collapsed":true},"properties":{"EventChannelTimer":{"additionalProperties":false,"id":"id_interrupt_timer_choice","options":{"collapsed":true},"properties":{"_compoundName":{"enum":["interrupt_timer"],"options":{"hidden":true},"type":"string"},"lalal":{"excludeFromFinalValue":true,"options":{"derived":true},"template":"return ce_deref(ce_refarr(vars,[\"watch_array\",\"clock\",\"avail_oc_units\"]),\"value\",vars.watch_id);","watch1":{"watch_array":"id_board.platform","watch_id":"id_interrupt_timer_choice.oc_unit"}},"oc_unit":{"enumSource":[{"sourceTemplate":"return ce_refarr(vars,[\"watch_array\",\"clock\",\"avail_oc_units\"]);","title":"return vars.item[\"value\"];","value":"return vars.item[\"value\"];"}],"propertyOrder":0,"title":"Output compare unit","type":"string","watch1":{"watch_array":"id_board.platform"}}},"propertyOrder":9,"title":"Event channel timer","type":"object"},"LedPin":{"propertyOrder":4,"title":"LED pin","type":"string"},"_compoundName":{"enum":["board"],"options":{"hidden":true},"type":"string"},"analog_inputs":{"items":{"additionalProperties":false,"headerTemplate":"return vars.self[\"Name\"];","options":{"collapsed":true},"properties":{"Name":{"propertyOrder":0,"title":"Name","type":"string"},"Pin":{"propertyOrder":1,"title":"Pin","type":"string"},"_compoundName":{"enum":["analog_input"],"options":{"hidden":true},"type":"string"}},"title":"Analog input","type":"object"},"options":{"disable_collapse":true},"propertyOrder":12,"title":"Analog inputs","type":"array"},"board_for_build":{"propertyOrder":2,"title":"Board for building (see nix/boards.nix)","type":"string"},"board_helper_includes":{"format":"table","items":{"title":"Name","type":"string"},"options":{"disable_collapse":true},"propertyOrder":15,"title":"Board helper includes","type":"array"},"config_manager":{"oneOf":[{"additionalProperties":false,"properties":{"_compoundName":{"enum":["ConstantConfigManager"],"options":{"hidden":true},"type":"string"}},"title":"Disabled","type":"object"},{"additionalProperties":false,"properties":{"ConfigStore":{"oneOf":[{"additionalProperties":false,"properties":{"_compoundName":{"enum":["NoStore"],"options":{"hidden":true},"type":"string"}},"title":"None","type":"object"},{"additionalProperties":false,"properties":{"Eeprom":{"oneOf":[{"additionalProperties":false,"properties":{"BlockSize":{"propertyOrder":3,"type":"integer"},"I2c":{"oneOf":[{"additionalProperties":false,"properties":{"Ckdiv":{"propertyOrder":1,"type":"integer"},"Device":{"propertyOrder":0,"type":"string"},"I2cFreq":{"propertyOrder":2,"type":"number"},"_compoundName":{"enum":["At91SamI2c"],"options":{"hidden":true},"type":"string"}},"title":"At91SamI2c","type":"object"}],"options":{"disable_collapse":true},"propertyOrder":0,"title":"I2C backend","type":"object"},"I2cAddr":{"propertyOrder":1,"type":"integer"},"Size":{"propertyOrder":2,"type":"integer"},"WriteTimeout":{"propertyOrder":4,"type":"number"},"_compoundName":{"enum":["I2cEeprom"],"options":{"hidden":true},"type":"string"}},"title":"I2cEeprom","type":"object"},{"additionalProperties":false,"properties":{"FakeBlockSize":{"propertyOrder":1,"type":"integer"},"Size":{"propertyOrder":0,"type":"integer"},"_compoundName":{"enum":["TeensyEeprom"],"options":{"hidden":true},"type":"string"}},"title":"TeensyEeprom","type":"object"}],"options":{"disable_collapse":true},"propertyOrder":0,"title":"EEPROM backend","type":"object"},"EndBlock":{"propertyOrder":2,"type":"integer"},"StartBlock":{"propertyOrder":1,"type":"integer"},"_compoundName":{"enum":["EepromConfigStore"],"options":{"hidden":true},"type":"string"}},"title":"EepromConfigStore","type":"object"}],"options":{"disable_collapse":true},"propertyOrder":0,"title":"Configuration storage","type":"object"},"_compoundName":{"enum":["RuntimeConfigManager"],"options":{"hidden":true},"type":"string"}},"title":"Enabled","type":"object"}],"options":{"collapsed":true},"propertyOrder":5,"title":"Runtime configuration","type":"object"},"digital_inputs":{"items":{"additionalProperties":false,"headerTemplate":"return vars.self[\"Name\"];","id":"id_board_digital_inputs","options":{"collapsed":true},"properties":{"InputMode":{"enumSource":[{"sourceTemplate":"return ce_refarr(vars,[\"watch_array\",\"pins\",\"input_modes\"]);","title":"return vars.item[\"name\"];","value":"return vars.item[\"ident\"];"}],"propertyOrder":2,"title":"Input mode","type":"string","watch1":{"watch_array":"id_board.platform"}},"Name":{"propertyOrder":0,"title":"Name","type":"string"},"Pin":{"propertyOrder":1,"title":"Pin","type":"string"},"_compoundName":{"enum":["digital_input"],"options":{"hidden":true},"type":"string"}},"title":"Digital input","type":"object"},"options":{"disable_collapse":true},"propertyOrder":11,"title":"Digital inputs","type":"array"},"identifier":{"propertyOrder":0,"title":"Identifier","type":"string"},"name":{"propertyOrder":1,"title":"Name","type":"string"},"output_type":{"enum":["hex","bin"],"propertyOrder":3,"title":"Build output type","type":"string"},"performance":{"additionalProperties":false,"options":{"collapsed":true},"properties":{"AxisDriverPrecisionParams":{"enum":["AxisDriverAvrPrecisionParams","AxisDriverDuePrecisionParams"],"propertyOrder":6,"title":"Stepping precision parameters","type":"string"},"EventChannelBufferSize":{"propertyOrder":2,"title":"Event channel buffer size","type":"integer"},"EventChannelTimerClearance":{"propertyOrder":7,"title":"Event channel timer clearance","type":"number"},"FpType":{"enum":["float","double"],"propertyOrder":5,"type":"string"},"LookaheadBufferSize":{"propertyOrder":3,"title":"Lookahead buffer size","type":"integer"},"LookaheadCommitCount":{"propertyOrder":4,"title":"Lookahead commit count","type":"integer"},"MaxStepsPerCycle":{"propertyOrder":0,"title":"Max steps per cycle","type":"number"},"StepperSegmentBufferSize":{"propertyOrder":1,"title":"Stepper segment buffer size","type":"integer"},"_compoundName":{"enum":["performance"],"options":{"hidden":true},"type":"string"}},"propertyOrder":8,"title":"Performance parameters","type":"object"},"platform":{"oneOf":[{"additionalProperties":false,"properties":{"_compoundName":{"enum":["At91Sam3x8e"],"options":{"hidden":true},"type":"string"},"adc":{"additionalProperties":false,"options":{"collapsed":true},"properties":{"_compoundName":{"enum":["At91SamAdc"],"options":{"hidden":true},"type":"string"},"avg_interval":{"propertyOrder":1,"title":"Averaging interval","type":"number"},"freq":{"propertyOrder":0,"title":"Frequency","type":"number"},"settling":{"propertyOrder":4,"title":"Settling time","type":"integer"},"smoothing":{"propertyOrder":2,"title":"Smoothing factor","type":"number"},"startup":{"propertyOrder":3,"title":"Startup time","type":"integer"},"tracking":{"propertyOrder":5,"title":"Tracking time","type":"integer"},"transfer":{"propertyOrder":6,"title":"Transfer time","type":"integer"}},"propertyOrder":1,"title":"ADC","type":"object"},"clock":{"additionalProperties":false,"options":{"collapsed":true},"properties":{"_compoundName":{"enum":["At91Sam3xClock"],"options":{"hidden":true},"type":"string"},"avail_oc_units":{"enum":[[{"value":"TC0A"},{"value":"TC0B"},{"value":"TC0C"},{"value":"TC1A"},{"value":"TC1B"},{"value":"TC1C"},{"value":"TC2A"},{"value":"TC2B"},{"value":"TC2C"},{"value":"TC3A"},{"value":"TC3B"},{"value":"TC3C"},{"value":"TC4A"},{"value":"TC4B"},{"value":"TC4C"},{"value":"TC5A"},{"value":"TC5B"},{"value":"TC5C"},{"value":"TC6A"},{"value":"TC6B"},{"value":"TC6C"},{"value":"TC7A"},{"value":"TC7B"},{"value":"TC7C"},{"value":"TC8A"},{"value":"TC8B"},{"value":"TC8C"}]],"options":{"hidden":true},"propertyOrder":2,"type":"array"},"prescaler":{"propertyOrder":0,"title":"Prescaler","type":"integer"},"primary_timer":{"propertyOrder":1,"title":"Primary timer","type":"string"}},"propertyOrder":0,"title":"Clock","type":"object"},"pins":{"additionalProperties":false,"options":{"collapsed":true},"properties":{"_compoundName":{"enum":["At91SamPins"],"options":{"hidden":true},"type":"string"},"input_modes":{"enum":[[{"ident":"At91SamPinInputModeNormal","name":"Normal"},{"ident":"At91SamPinInputModePullUp","name":"Pull-up"}]],"options":{"hidden":true},"propertyOrder":0,"type":"array"}},"propertyOrder":3,"title":"Pins","type":"object"},"watchdog":{"additionalProperties":false,"options":{"collapsed":true},"properties":{"Wdv":{"propertyOrder":0,"title":"Wdv","type":"integer"},"_compoundName":{"enum":["At91SamWatchdog"],"options":{"hidden":true},"type":"string"}},"propertyOrder":2,"title":"Watchdog","type":"object"}},"title":"At91Sam3x8e","type":"object"},{"additionalProperties":false,"properties":{"_compoundName":{"enum":["Teensy3"],"options":{"hidden":true},"type":"string"},"adc":{"additionalProperties":false,"options":{"collapsed":true},"properties":{"AdcADiv":{"propertyOrder":0,"title":"AdcADiv","type":"integer"},"_compoundName":{"enum":["Mk20Adc"],"options":{"hidden":true},"type":"string"}},"propertyOrder":1,"title":"ADC","type":"object"},"clock":{"additionalProperties":false,"options":{"collapsed":true},"properties":{"_compoundName":{"enum":["Mk20Clock"],"options":{"hidden":true},"type":"string"},"avail_oc_units":{"enum":[[{"value":"FTM0_0"},{"value":"FTM0_1"},{"value":"FTM0_2"},{"value":"FTM0_3"},{"value":"FTM0_4"},{"value":"FTM0_5"},{"value":"FTM0_6"},{"value":"FTM0_7"},{"value":"FTM1_0"},{"value":"FTM1_1"}]],"options":{"hidden":true},"propertyOrder":2,"type":"array"},"prescaler":{"propertyOrder":0,"title":"Prescaler","type":"integer"},"primary_timer":{"propertyOrder":1,"title":"Primary timer","type":"string"}},"propertyOrder":0,"title":"Clock","type":"object"},"pins":{"additionalProperties":false,"options":{"collapsed":true},"properties":{"_compoundName":{"enum":["Mk20Pins"],"options":{"hidden":true},"type":"string"},"input_modes":{"enum":[[{"ident":"Mk20PinInputModeNormal","name":"Normal"},{"ident":"Mk20PinInputModePullUp","name":"Pull-up"},{"ident":"Mk20PinInputModePullDown","name":"Pull-down"}]],"options":{"hidden":true},"propertyOrder":0,"type":"array"}},"propertyOrder":3,"title":"Pins","type":"object"},"watchdog":{"additionalProperties":false,"options":{"collapsed":true},"properties":{"Prescval":{"propertyOrder":1,"title":"Prescaler value","type":"integer"},"Toval":{"propertyOrder":0,"title":"Timeout value","type":"integer"},"_compoundName":{"enum":["Mk20Watchdog"],"options":{"hidden":true},"type":"string"}},"propertyOrder":2,"title":"Watchdog","type":"object"}},"title":"Teensy3","type":"object"}],"options":{"disable_collapse":true},"processingOrder":-1,"propertyOrder":14,"title":"Platform","type":"object"},"pwm_outputs":{"items":{"additionalProperties":false,"headerTemplate":"return vars.self[\"Name\"];","options":{"collapsed":true},"properties":{"Backend":{"oneOf":[{"additionalProperties":false,"properties":{"OutputInvert":{"enum":[false,true],"options":{"enum_titles":["Normal (On=High)","Inverted (On=Low)"]},"propertyOrder":1,"title":"Output logic","type":"boolean"},"OutputPin":{"propertyOrder":0,"title":"Output pin","type":"string"},"PulseInterval":{"propertyOrder":2,"title":"PWM pulse duration","type":"number"},"Timer":{"additionalProperties":false,"id":"id_interrupt_timer_choice","options":{"collapsed":true},"properties":{"_compoundName":{"enum":["interrupt_timer"],"options":{"hidden":true},"type":"string"},"lalal":{"excludeFromFinalValue":true,"options":{"derived":true},"template":"return ce_deref(ce_refarr(vars,[\"watch_array\",\"clock\",\"avail_oc_units\"]),\"value\",vars.watch_id);","watch1":{"watch_array":"id_board.platform","watch_id":"id_interrupt_timer_choice.oc_unit"}},"oc_unit":{"enumSource":[{"sourceTemplate":"return ce_refarr(vars,[\"watch_array\",\"clock\",\"avail_oc_units\"]);","title":"return vars.item[\"value\"];","value":"return vars.item[\"value\"];"}],"propertyOrder":0,"title":"Output compare unit","type":"string","watch1":{"watch_array":"id_board.platform"}}},"propertyOrder":3,"title":"Soft PWM Timer","type":"object"},"_compoundName":{"enum":["SoftPwm"],"options":{"hidden":true},"type":"string"}},"title":"SoftPwm","type":"object"}],"options":{"disable_collapse":true},"propertyOrder":1,"title":"Backend","type":"object"},"Name":{"propertyOrder":0,"title":"Name","type":"string"},"_compoundName":{"enum":["pwm_output"],"options":{"hidden":true},"type":"string"}},"title":"PWM output","type":"object"},"options":{"disable_collapse":true},"propertyOrder":13,"title":"PWM outputs","type":"array"},"sdcard":{"oneOf":[{"additionalProperties":false,"properties":{"_compoundName":{"enum":["NoSdCard"],"options":{"hidden":true},"type":"string"}},"title":"Disabled","type":"object"},{"additionalProperties":false,"properties":{"BufferBaseSize":{"propertyOrder":0,"title":"Buffer size","type":"integer"},"GcodeParser":{"oneOf":[{"additionalProperties":false,"properties":{"MaxParts":{"propertyOrder":0,"title":"Maximum number of command parts","type":"integer"},"_compoundName":{"enum":["TextGcodeParser"],"options":{"hidden":true},"type":"string"}},"title":"Text G-code parser","type":"object"},{"additionalProperties":false,"properties":{"MaxParts":{"propertyOrder":0,"title":"Maximum number of command parts","type":"integer"},"_compoundName":{"enum":["BinaryGcodeParser"],"options":{"hidden":true},"type":"string"}},"title":"Binary G-code parser","type":"object"}],"propertyOrder":2,"title":"G-code parser","type":"object"},"MaxCommandSize":{"propertyOrder":1,"title":"Maximum command size","type":"integer"},"SdCardService":{"oneOf":[{"additionalProperties":false,"properties":{"SpiService":{"oneOf":[{"additionalProperties":false,"properties":{"Device":{"propertyOrder":0,"type":"string"},"_compoundName":{"enum":["At91SamSpi"],"options":{"hidden":true},"type":"string"}},"title":"At91SamSpi","type":"object"}],"options":{"disable_collapse":true},"propertyOrder":1,"title":"SPI driver","type":"object"},"SsPin":{"propertyOrder":0,"title":"SS pin","type":"string"},"_compoundName":{"enum":["SpiSdCard"],"options":{"hidden":true},"type":"string"}},"title":"SPI","type":"object"}],"options":{"collapsed":true},"propertyOrder":3,"title":"Driver","type":"object"},"_compoundName":{"enum":["SdCard"],"options":{"hidden":true},"type":"string"}},"title":"Enabled","type":"object"}],"options":{"collapsed":true},"propertyOrder":7,"title":"SD card","type":"object"},"serial":{"additionalProperties":false,"options":{"collapsed":true},"properties":{"BaudRate":{"propertyOrder":0,"title":"Baud rate","type":"integer"},"GcodeMaxParts":{"propertyOrder":3,"title":"Max parts in GCode command","type":"integer"},"RecvBufferSizeExp":{"propertyOrder":1,"title":"Receive buffer size (power of two exponent)","type":"integer"},"SendBufferSizeExp":{"propertyOrder":2,"title":"Send buffer size (power of two exponent)","type":"integer"},"Service":{"oneOf":[{"additionalProperties":false,"properties":{"_compoundName":{"enum":["AsfUsbSerial"],"options":{"hidden":true},"type":"string"}},"title":"AT91 USB","type":"object"},{"additionalProperties":false,"properties":{"_compoundName":{"enum":["At91Sam3xSerial"],"options":{"hidden":true},"type":"string"}},"title":"AT91 UART","type":"object"},{"additionalProperties":false,"properties":{"_compoundName":{"enum":["TeensyUsbSerial"],"options":{"hidden":true},"type":"string"}},"title":"Teensy3 USB","type":"object"}],"options":{"disable_collapse":true},"propertyOrder":4,"title":"Backend","type":"object"},"_compoundName":{"enum":["serial"],"options":{"hidden":true},"type":"string"}},"propertyOrder":6,"title":"Serial parameters","type":"object"},"stepper_ports":{"items":{"additionalProperties":false,"headerTemplate":"return vars.self[\"Name\"];","options":{"collapsed":true},"properties":{"DirPin":{"propertyOrder":1,"title":"Direction pin","type":"string"},"EnablePin":{"propertyOrder":3,"title":"Enable pin","type":"string"},"Name":{"propertyOrder":0,"title":"Name","type":"string"},"StepPin":{"propertyOrder":2,"title":"Step pin","type":"string"},"StepperTimer":{"additionalProperties":false,"id":"id_interrupt_timer_choice","options":{"collapsed":true},"properties":{"_compoundName":{"enum":["interrupt_timer"],"options":{"hidden":true},"type":"string"},"lalal":{"excludeFromFinalValue":true,"options":{"derived":true},"template":"return ce_deref(ce_refarr(vars,[\"watch_array\",\"clock\",\"avail_oc_units\"]),\"value\",vars.watch_id);","watch1":{"watch_array":"id_board.platform","watch_id":"id_interrupt_timer_choice.oc_unit"}},"oc_unit":{"enumSource":[{"sourceTemplate":"return ce_refarr(vars,[\"watch_array\",\"clock\",\"avail_oc_units\"]);","title":"return vars.item[\"value\"];","value":"return vars.item[\"value\"];"}],"propertyOrder":0,"title":"Output compare unit","type":"string","watch1":{"watch_array":"id_board.platform"}}},"propertyOrder":4,"title":"Stepper timer","type":"object"},"_compoundName":{"enum":["stepper_port"],"options":{"hidden":true},"type":"string"}},"title":"Stepper port","type":"object"},"options":{"disable_collapse":true},"propertyOrder":10,"title":"Stepper ports","type":"array"}},"title":"Board","type":"object"},"processingOrder":-2,"propertyOrder":3,"title":"Boards","type":"array"},"configurations":{"items":{"additionalProperties":false,"headerTemplate":"return vars.self[\"name\"];","id":"id_configuration","options":{"collapsed":true},"properties":{"InactiveTime":{"propertyOrder":2,"title":"Inactive time","type":"number"},"_compoundName":{"enum":["config"],"options":{"hidden":true},"type":"string"},"advanced":{"additionalProperties":false,"options":{"collapsed":true},"properties":{"ForceTimeout":{"propertyOrder":1,"title":"Force timeout","type":"number"},"LedBlinkInterval":{"propertyOrder":0,"title":"LED blink interval","type":"number"},"_compoundName":{"enum":["advanced"],"options":{"hidden":true},"type":"string"}},"propertyOrder":3,"title":"Advanced parameters","type":"object"},"board_data":{"excludeFromFinalValue":true,"options":{"derived":true},"template":"return ce_deref(ce_refarr(vars,[\"watch_array\"]),\"identifier\",vars.watch_id);","watch1":{"watch_array":"boards","watch_id":"id_configuration.board_id"}},"board_id":{"enumSource":[{"sourceTemplate":"return ce_refarr(vars,[\"watch_array\"]);","title":"return vars.item[\"name\"];","value":"return vars.item[\"identifier\"];"}],"processingOrder":-1,"propertyOrder":1,"title":"Board","type":"string","watch1":{"watch_array":"boards"}},"fans":{"items":{"additionalProperties":false,"headerTemplate":"return vars.self[\"Name\"];","id":"id_configuration_fan","options":{"collapsed":true},"properties":{"Name":{"propertyOrder":0,"title":"Name","type":"string"},"OffMCommand":{"propertyOrder":3,"title":"Off command M-number","type":"integer"},"SetMCommand":{"propertyOrder":2,"title":"Set command M-number","type":"integer"},"_compoundName":{"enum":["fan"],"options":{"hidden":true},"type":"string"},"pwm_output":{"enumSource":[{"sourceTemplate":"return ce_refarr(vars,[\"watch_array\",\"pwm_outputs\"]);","title":"return vars.item[\"Name\"];","value":"return vars.item[\"Name\"];"}],"propertyOrder":1,"title":"PWM output","type":"string","watch1":{"watch_array":"id_configuration.board_data"}}},"title":"Fan","type":"object"},"options":{"disable_collapse":true},"propertyOrder":6,"title":"Fans","type":"array"},"heaters":{"items":{"additionalProperties":false,"headerTemplate":"return vars.self[\"Name\"];","id":"id_configuration_heater","options":{"collapsed":true},"properties":{"MaxSafeTemp":{"propertyOrder":6,"title":"Maximum safe temperature [C]","type":"number"},"MinSafeTemp":{"propertyOrder":5,"title":"Minimum safe temperature [C]","type":"number"},"Name":{"propertyOrder":0,"title":"Name","type":"string"},"SetMCommand":{"propertyOrder":2,"title":"Set command M-number","type":"integer"},"ThermistorInput":{"enumSource":[{"sourceTemplate":"return ce_refarr(vars,[\"watch_array\",\"analog_inputs\"]);","title":"return vars.item[\"Name\"];","value":"return vars.item[\"Name\"];"}],"propertyOrder":4,"title":"Thermistor analog input","type":"string","watch1":{"watch_array":"id_configuration.board_data"}},"WaitMCommand":{"propertyOrder":3,"title":"Wait command M-number","type":"integer"},"_compoundName":{"enum":["heater"],"options":{"hidden":true},"type":"string"},"control":{"additionalProperties":false,"options":{"collapsed":true},"properties":{"ControlInterval":{"propertyOrder":0,"title":"Control interval [s]","type":"number"},"PidD":{"propertyOrder":3,"title":"PID derivative factor [s/K]","type":"number"},"PidDHistory":{"propertyOrder":6,"title":"PID derivative smoothing factor [1]","type":"number"},"PidI":{"propertyOrder":2,"title":"PID integral factor [1/(Ks)]","type":"number"},"PidIStateMax":{"propertyOrder":5,"title":"PID integral state max [1]","type":"number"},"PidIStateMin":{"propertyOrder":4,"title":"PID integral state min [1]","type":"number"},"PidP":{"propertyOrder":1,"title":"PID proportional factor [1/K]","type":"number"},"_compoundName":{"enum":["control"],"options":{"hidden":true},"type":"string"}},"propertyOrder":8,"title":"Control parameters","type":"object"},"conversion":{"additionalProperties":false,"options":{"collapsed":true},"properties":{"Beta":{"propertyOrder":2,"title":"Thermistor beta value [K]","type":"number"},"MaxTemp":{"propertyOrder":4,"title":"Maximum temperature [C]","type":"number"},"MinTemp":{"propertyOrder":3,"title":"Minimum temperature [C]","type":"number"},"R0":{"propertyOrder":1,"title":"Thermistor resistance @25C [ohm]","type":"number"},"ResistorR":{"propertyOrder":0,"title":"Resistor resistance [ohm]","type":"number"},"_compoundName":{"enum":["conversion"],"options":{"hidden":true},"type":"string"}},"propertyOrder":7,"title":"Conversion parameters","type":"object"},"observer":{"additionalProperties":false,"options":{"collapsed":true},"properties":{"ObserverInterval":{"propertyOrder":0,"title":"Observation interval [s]","type":"number"},"ObserverMinTime":{"propertyOrder":2,"title":"Observation minimum time [s]","type":"number"},"ObserverTolerance":{"propertyOrder":1,"title":"Observation tolerance [K]","type":"number"},"_compoundName":{"enum":["observer"],"options":{"hidden":true},"type":"string"}},"propertyOrder":9,"title":"Observation parameters","type":"object"},"pwm_output":{"enumSource":[{"sourceTemplate":"return ce_refarr(vars,[\"watch_array\",\"pwm_outputs\"]);","title":"return vars.item[\"Name\"];","value":"return vars.item[\"Name\"];"}],"propertyOrder":1,"title":"PWM output","type":"string","watch1":{"watch_array":"id_configuration.board_data"}}},"title":"Heater","type":"object"},"options":{"disable_collapse":true},"propertyOrder":5,"title":"Heaters","type":"array"},"name":{"propertyOrder":0,"title":"Name","type":"string"},"probe":{"oneOf":[{"additionalProperties":false,"properties":{"_compoundName":{"enum":["NoProbe"],"options":{"hidden":true},"type":"string"}},"title":"Disabled","type":"object"},{"additionalProperties":false,"id":"id_configuration_probe_probe","properties":{"FastSpeed":{"propertyOrder":8,"title":"Fast (first) probing speed","type":"number"},"InvertInput":{"enum":[false,true],"options":{"enum_titles":["No","Yes"]},"propertyOrder":1,"title":"Invert input","type":"boolean"},"LowHeight":{"propertyOrder":5,"title":"Minimum Z to move down to","type":"number"},"MoveSpeed":{"propertyOrder":7,"title":"Speed for moving to probe points","type":"number"},"OffsetX":{"propertyOrder":2,"title":"Probe offset (X)","type":"number"},"OffsetY":{"propertyOrder":3,"title":"Probe offset (Y)","type":"number"},"ProbePin":{"enumSource":[{"sourceTemplate":"return ce_refarr(vars,[\"watch_array\",\"digital_inputs\"]);","title":"return vars.item[\"Name\"];","value":"return vars.item[\"Name\"];"}],"propertyOrder":0,"title":"Probe pin","type":"string","watch1":{"watch_array":"id_configuration.board_data"}},"ProbePoints":{"items":{"additionalProperties":false,"properties":{"X":{"propertyOrder":0,"type":"number"},"Y":{"propertyOrder":1,"type":"number"},"_compoundName":{"enum":["ProbePoint"],"options":{"hidden":true},"type":"string"}},"title":"Probe point","type":"object"},"propertyOrder":11,"title":"Probe points","type":"array"},"RetractDist":{"propertyOrder":6,"title":"Retraction distance","type":"number"},"RetractSpeed":{"propertyOrder":9,"title":"Retraction speed","type":"number"},"SlowSpeed":{"propertyOrder":10,"title":"Slow (second) probing speed","type":"number"},"StartHeight":{"propertyOrder":4,"title":"Starting Z for probing a point","type":"number"},"_compoundName":{"enum":["Probe"],"options":{"hidden":true},"type":"string"}},"title":"Enabled","type":"object"}],"options":{"collapsed":true},"propertyOrder":7,"title":"Bed probing","type":"object"},"steppers":{"items":{"additionalProperties":false,"headerTemplate":"return vars.self[\"Name\"];","id":"id_configuration_stepper","options":{"collapsed":true},"properties":{"CorneringDistance":{"propertyOrder":9,"title":"Cornering distance","type":"number"},"DistanceFactor":{"propertyOrder":8,"title":"Distance factor","type":"number"},"EnableCartesianSpeedLimit":{"enum":[false,true],"options":{"enum_titles":["No","Yes"]},"propertyOrder":10,"title":"Is cartesian","type":"boolean"},"InvertDir":{"enum":[false,true],"options":{"enum_titles":["No","Yes"]},"propertyOrder":2,"title":"Invert direction","type":"boolean"},"MaxAccel":{"propertyOrder":7,"title":"Maximum acceleration","type":"number"},"MaxPos":{"propertyOrder":5,"title":"Maximum position","type":"number"},"MaxSpeed":{"propertyOrder":6,"title":"Maximum speed","type":"number"},"MinPos":{"propertyOrder":4,"title":"Minimum position","type":"number"},"Name":{"propertyOrder":0,"title":"Name","type":"string"},"StepsPerUnit":{"propertyOrder":3,"title":"Steps per unit","type":"number"},"_compoundName":{"enum":["stepper"],"options":{"hidden":true},"type":"string"},"homing":{"oneOf":[{"additionalProperties":false,"properties":{"_compoundName":{"enum":["no_homing"],"options":{"hidden":true},"type":"string"}},"title":"Disabled","type":"object"},{"additionalProperties":false,"id":"id_board_steppers_homing","properties":{"HomeDir":{"enum":[false,true],"options":{"enum_titles":["Negative","Positive"]},"propertyOrder":0,"title":"Homing direction","type":"boolean"},"HomeEndInvert":{"enum":[false,true],"options":{"enum_titles":["No","Yes"]},"propertyOrder":2,"title":"Invert endstop","type":"boolean"},"HomeEndstopInput":{"enumSource":[{"sourceTemplate":"return ce_refarr(vars,[\"watch_array\",\"digital_inputs\"]);","title":"return vars.item[\"Name\"];","value":"return vars.item[\"Name\"];"}],"propertyOrder":1,"title":"Endstop digital input","type":"string","watch1":{"watch_array":"id_configuration.board_data"}},"HomeFastMaxDist":{"propertyOrder":3,"title":"Maximum fast (initial) travel","type":"number"},"HomeFastSpeed":{"propertyOrder":6,"title":"Fast speed","type":"number"},"HomeRetractDist":{"propertyOrder":4,"title":"Retraction travel","type":"number"},"HomeRetractSpeed":{"propertyOrder":7,"title":"Retraction speed","type":"number"},"HomeSlowMaxDist":{"propertyOrder":5,"title":"Maximum slow (after retraction) travel","type":"number"},"HomeSlowSpeed":{"propertyOrder":8,"title":"Slow speed","type":"number"},"_compoundName":{"enum":["homing"],"options":{"hidden":true},"type":"string"}},"title":"Enabled","type":"object"}],"options":{"collapsed":true},"propertyOrder":11,"title":"Homing","type":"object"},"stepper_port":{"enumSource":[{"sourceTemplate":"return ce_refarr(vars,[\"watch_array\",\"stepper_ports\"]);","title":"return vars.item[\"Name\"];","value":"return vars.item[\"Name\"];"}],"propertyOrder":1,"title":"Stepper port","type":"string","watch1":{"watch_array":"id_configuration.board_data"}}},"title":"Stepper","type":"object"},"options":{"disable_collapse":true},"propertyOrder":4,"title":"Steppers","type":"array"}},"title":"Configuration","type":"object"},"processingOrder":-1,"propertyOrder":2,"title":"Configurations","type":"array"},"selected_config":{"enumSource":[{"sourceTemplate":"return ce_refarr(vars,[\"watch_array\"]);","title":"return vars.item[\"name\"];","value":"return vars.item[\"name\"];"}],"propertyOrder":1,"title":"Selected configuration (to compile)","type":"string","watch1":{"watch_array":"configurations"}},"version":{"enum":[1],"options":{"hidden":true},"propertyOrder":0,"type":"integer"}},"title":"Configuration editor","type":"object"};

// The default configuration.
var default_config = {"_compoundName":"editor","boards":[{"EventChannelTimer":{"_compoundName":"interrupt_timer","oc_unit":"TC0A"},"LedPin":"DuePin37","_compoundName":"board","analog_inputs":[{"Name":"T0","Pin":"DuePinA0","_compoundName":"analog_input"},{"Name":"T1","Pin":"DuePinA1","_compoundName":"analog_input"},{"Name":"T2","Pin":"DuePinA2","_compoundName":"analog_input"},{"Name":"T3","Pin":"DuePinA3","_compoundName":"analog_input"},{"Name":"T4","Pin":"DuePinA4","_compoundName":"analog_input"}],"board_for_build":"arduino_due","board_helper_includes":["arduino_due_pins"],"config_manager":{"ConfigStore":{"Eeprom":{"BlockSize":64,"I2c":{"Ckdiv":2,"Device":"At91SamI2cDevice1","I2cFreq":100000,"_compoundName":"At91SamI2c"},"I2cAddr":80,"Size":32768,"WriteTimeout":1,"_compoundName":"I2cEeprom"},"EndBlock":512,"StartBlock":0,"_compoundName":"EepromConfigStore"},"_compoundName":"RuntimeConfigManager"},"digital_inputs":[{"InputMode":"At91SamPinInputModePullUp","Name":"X-MIN","Pin":"DuePin28","_compoundName":"digital_input"},{"InputMode":"At91SamPinInputModePullUp","Name":"Y-MIN","Pin":"DuePin30","_compoundName":"digital_input"},{"InputMode":"At91SamPinInputModePullUp","Name":"Z-MIN","Pin":"DuePin32","_compoundName":"digital_input"},{"InputMode":"At91SamPinInputModePullUp","Name":"X-MAX","Pin":"DuePin34","_compoundName":"digital_input"},{"InputMode":"At91SamPinInputModePullUp","Name":"Y-MAX","Pin":"DuePin36","_compoundName":"digital_input"},{"InputMode":"At91SamPinInputModePullUp","Name":"Z-MAX","Pin":"DuePin38","_compoundName":"digital_input"}],"identifier":"radds","name":"RADDS","output_type":"bin","performance":{"AxisDriverPrecisionParams":"AxisDriverDuePrecisionParams","EventChannelBufferSize":32,"EventChannelTimerClearance":0.002,"FpType":"double","LookaheadBufferSize":28,"LookaheadCommitCount":10,"MaxStepsPerCycle":0.0017,"StepperSegmentBufferSize":32,"_compoundName":"performance"},"platform":{"_compoundName":"At91Sam3x8e","adc":{"_compoundName":"At91SamAdc","avg_interval":0.0025,"freq":1000000,"settling":3,"smoothing":0.95,"startup":8,"tracking":0,"transfer":1},"clock":{"_compoundName":"At91Sam3xClock","avail_oc_units":[{"value":"TC0A"},{"value":"TC0B"},{"value":"TC0C"},{"value":"TC1A"},{"value":"TC1B"},{"value":"TC1C"},{"value":"TC2A"},{"value":"TC2B"},{"value":"TC2C"},{"value":"TC3A"},{"value":"TC3B"},{"value":"TC3C"},{"value":"TC4A"},{"value":"TC4B"},{"value":"TC4C"},{"value":"TC5A"},{"value":"TC5B"},{"value":"TC5C"},{"value":"TC6A"},{"value":"TC6B"},{"value":"TC6C"},{"value":"TC7A"},{"value":"TC7B"},{"value":"TC7C"},{"value":"TC8A"},{"value":"TC8B"},{"value":"TC8C"}],"prescaler":3,"primary_timer":"TC0"},"pins":{"_compoundName":"At91SamPins","input_modes":[{"ident":"At91SamPinInputModeNormal","name":"Normal"},{"ident":"At91SamPinInputModePullUp","name":"Pull-up"}]},"watchdog":{"Wdv":260,"_compoundName":"At91SamWatchdog"}},"pwm_outputs":[{"Backend":{"OutputInvert":false,"OutputPin":"DuePin7","PulseInterval":0.3,"Timer":{"_compoundName":"interrupt_timer","lalal":{"value":"TC7A"},"oc_unit":"TC7A"},"_compoundName":"SoftPwm"},"Name":"FET1 (bed)","_compoundName":"pwm_output"},{"Backend":{"OutputInvert":false,"OutputPin":"DuePin13","PulseInterval":0.2,"Timer":{"_compoundName":"interrupt_timer","lalal":{"value":"TC7B"},"oc_unit":"TC7B"},"_compoundName":"SoftPwm"},"Name":"FET6 (extruder 1)","_compoundName":"pwm_output"},{"Backend":{"OutputInvert":false,"OutputPin":"DuePin12","PulseInterval":0.2,"Timer":{"_compoundName":"interrupt_timer","lalal":{"value":"TC7C"},"oc_unit":"TC7C"},"_compoundName":"SoftPwm"},"Name":"FET5 (extruder 2)","_compoundName":"pwm_output"},{"Backend":{"OutputInvert":false,"OutputPin":"DuePin11","PulseInterval":0.2,"Timer":{"_compoundName":"interrupt_timer","lalal":{"value":"TC8A"},"oc_unit":"TC8A"},"_compoundName":"SoftPwm"},"Name":"FET4 (extruder 3)","_compoundName":"pwm_output"},{"Backend":{"OutputInvert":false,"OutputPin":"DuePin9","PulseInterval":0.04,"Timer":{"_compoundName":"interrupt_timer","lalal":{"value":"TC8B"},"oc_unit":"TC8B"},"_compoundName":"SoftPwm"},"Name":"FET3 (fan 1)","_compoundName":"pwm_output"},{"Backend":{"OutputInvert":false,"OutputPin":"DuePin8","PulseInterval":0.04,"Timer":{"_compoundName":"interrupt_timer","lalal":{"value":"TC8C"},"oc_unit":"TC8C"},"_compoundName":"SoftPwm"},"Name":"FET2 (fan 2)","_compoundName":"pwm_output"}],"sdcard":{"BufferBaseSize":2048,"GcodeParser":{"MaxParts":8,"_compoundName":"TextGcodeParser"},"MaxCommandSize":256,"SdCardService":{"SpiService":{"Device":"At91Sam3xSpiDevice","_compoundName":"At91SamSpi"},"SsPin":"DuePin4","_compoundName":"SpiSdCard"},"_compoundName":"SdCard"},"serial":{"BaudRate":115200,"GcodeMaxParts":16,"RecvBufferSizeExp":8,"SendBufferSizeExp":9,"Service":{"_compoundName":"AsfUsbSerial"},"_compoundName":"serial"},"stepper_ports":[{"DirPin":"DuePin23","EnablePin":"DuePin26","Name":"X","StepPin":"DuePin24","StepperTimer":{"_compoundName":"interrupt_timer","oc_unit":"TC1A"},"_compoundName":"stepper_port"},{"DirPin":"DuePin16","EnablePin":"DuePin22","Name":"Y","StepPin":"DuePin17","StepperTimer":{"_compoundName":"interrupt_timer","oc_unit":"TC2A"},"_compoundName":"stepper_port"},{"DirPin":"DuePin3","EnablePin":"DuePin15","Name":"Z","StepPin":"DuePin2","StepperTimer":{"_compoundName":"interrupt_timer","oc_unit":"TC3A"},"_compoundName":"stepper_port"},{"DirPin":"DuePinA6","EnablePin":"DuePinA8","Name":"E1","StepPin":"DuePinA7","StepperTimer":{"_compoundName":"interrupt_timer","oc_unit":"TC4A"},"_compoundName":"stepper_port"},{"DirPin":"DuePinA9","EnablePin":"DuePinA11","Name":"E2","StepPin":"DuePinA10","StepperTimer":{"_compoundName":"interrupt_timer","oc_unit":"TC5A"},"_compoundName":"stepper_port"},{"DirPin":"DuePin53","EnablePin":"DuePin49","Name":"E3","StepPin":"DuePin51","StepperTimer":{"_compoundName":"interrupt_timer","oc_unit":"TC6A"},"_compoundName":"stepper_port"}]},{"EventChannelTimer":{"_compoundName":"interrupt_timer","oc_unit":"FTM0_0"},"LedPin":"TeensyPin13","_compoundName":"board","analog_inputs":[{"Name":"T","Pin":"TeensyPinA2","_compoundName":"analog_input"}],"board_for_build":"teensy3","board_helper_includes":["teensy3_pins"],"config_manager":{"ConfigStore":{"Eeprom":{"FakeBlockSize":16,"Size":2048,"_compoundName":"TeensyEeprom"},"EndBlock":128,"StartBlock":0,"_compoundName":"EepromConfigStore"},"_compoundName":"RuntimeConfigManager"},"digital_inputs":[{"InputMode":"Mk20PinInputModePullUp","Name":"X-min","Pin":"TeensyPin12","_compoundName":"digital_input"},{"InputMode":"Mk20PinInputModePullUp","Name":"Y-min","Pin":"TeensyPin14","_compoundName":"digital_input"},{"InputMode":"Mk20PinInputModePullUp","Name":"Z-min","Pin":"TeensyPin15","_compoundName":"digital_input"}],"identifier":"teensy3","name":"Teensy 3","output_type":"hex","performance":{"AxisDriverPrecisionParams":"AxisDriverDuePrecisionParams","EventChannelBufferSize":32,"EventChannelTimerClearance":0.002,"FpType":"float","LookaheadBufferSize":28,"LookaheadCommitCount":10,"MaxStepsPerCycle":0.0017,"StepperSegmentBufferSize":32,"_compoundName":"performance"},"platform":{"_compoundName":"Teensy3","adc":{"AdcADiv":3,"_compoundName":"Mk20Adc"},"clock":{"_compoundName":"Mk20Clock","avail_oc_units":[{"value":"FTM0_0"},{"value":"FTM0_1"},{"value":"FTM0_2"},{"value":"FTM0_3"},{"value":"FTM0_4"},{"value":"FTM0_5"},{"value":"FTM0_6"},{"value":"FTM0_7"},{"value":"FTM1_0"},{"value":"FTM1_1"}],"prescaler":4,"primary_timer":"FTM0"},"pins":{"_compoundName":"Mk20Pins","input_modes":[{"ident":"Mk20PinInputModeNormal","name":"Normal"},{"ident":"Mk20PinInputModePullUp","name":"Pull-up"},{"ident":"Mk20PinInputModePullDown","name":"Pull-down"}]},"watchdog":{"Prescval":0,"Toval":2000,"_compoundName":"Mk20Watchdog"}},"pwm_outputs":[{"Backend":{"OutputInvert":false,"OutputPin":"TeensyPin17","PulseInterval":0.2,"Timer":{"_compoundName":"interrupt_timer","lalal":{"value":"FTM0_5"},"oc_unit":"FTM0_5"},"_compoundName":"SoftPwm"},"Name":"Extruder","_compoundName":"pwm_output"},{"Backend":{"OutputInvert":false,"OutputPin":"TeensyPin18","PulseInterval":0.04,"Timer":{"_compoundName":"interrupt_timer","lalal":{"value":"FTM0_6"},"oc_unit":"FTM0_6"},"_compoundName":"SoftPwm"},"Name":"Fan","_compoundName":"pwm_output"}],"sdcard":{"_compoundName":"NoSdCard"},"serial":{"BaudRate":0,"GcodeMaxParts":16,"RecvBufferSizeExp":8,"SendBufferSizeExp":8,"Service":{"_compoundName":"TeensyUsbSerial"},"_compoundName":"serial"},"stepper_ports":[{"DirPin":"TeensyPin1","EnablePin":"TeensyPin8","Name":"X","StepPin":"TeensyPin0","StepperTimer":{"_compoundName":"interrupt_timer","oc_unit":"FTM0_1"},"_compoundName":"stepper_port"},{"DirPin":"TeensyPin3","EnablePin":"TeensyPin9","Name":"Y","StepPin":"TeensyPin2","StepperTimer":{"_compoundName":"interrupt_timer","oc_unit":"FTM0_2"},"_compoundName":"stepper_port"},{"DirPin":"TeensyPin5","EnablePin":"TeensyPin10","Name":"Z","StepPin":"TeensyPin4","StepperTimer":{"_compoundName":"interrupt_timer","oc_unit":"FTM0_3"},"_compoundName":"stepper_port"},{"DirPin":"TeensyPin7","EnablePin":"TeensyPin11","Name":"E","StepPin":"TeensyPin6","StepperTimer":{"_compoundName":"interrupt_timer","oc_unit":"FTM0_4"},"_compoundName":"stepper_port"}]}],"configurations":[{"InactiveTime":480,"_compoundName":"config","advanced":{"ForceTimeout":0.1,"LedBlinkInterval":0.5,"_compoundName":"advanced"},"board_id":"radds","fans":[{"Name":"E","OffMCommand":107,"SetMCommand":106,"_compoundName":"fan","pwm_output":"FET3 (fan 1)"},{"Name":"U","OffMCommand":407,"SetMCommand":406,"_compoundName":"fan","pwm_output":"FET2 (fan 2)"}],"heaters":[{"MaxSafeTemp":280,"MinSafeTemp":15,"Name":"T","SetMCommand":104,"ThermistorInput":"T0","WaitMCommand":109,"_compoundName":"heater","control":{"ControlInterval":0.2,"PidD":0.17,"PidDHistory":0.7,"PidI":0.0006,"PidIStateMax":0.6,"PidIStateMin":0,"PidP":0.047,"_compoundName":"control"},"conversion":{"Beta":3960,"MaxTemp":300,"MinTemp":10,"R0":100000,"ResistorR":4700,"_compoundName":"conversion"},"observer":{"ObserverInterval":0.5,"ObserverMinTime":3,"ObserverTolerance":3,"_compoundName":"observer"},"pwm_output":"FET6 (extruder 1)"},{"MaxSafeTemp":120,"MinSafeTemp":15,"Name":"B","SetMCommand":140,"ThermistorInput":"T4","WaitMCommand":190,"_compoundName":"heater","control":{"ControlInterval":0.3,"PidD":2.5,"PidDHistory":0.8,"PidI":0.012,"PidIStateMax":1,"PidIStateMin":0,"PidP":1,"_compoundName":"control"},"conversion":{"Beta":3480,"MaxTemp":150,"MinTemp":10,"R0":10000,"ResistorR":4700,"_compoundName":"conversion"},"observer":{"ObserverInterval":0.5,"ObserverMinTime":3,"ObserverTolerance":1.5,"_compoundName":"observer"},"pwm_output":"FET1 (bed)"},{"MaxSafeTemp":280,"MinSafeTemp":15,"Name":"U","SetMCommand":404,"ThermistorInput":"T1","WaitMCommand":409,"_compoundName":"heater","control":{"ControlInterval":0.2,"PidD":0.17,"PidDHistory":0.7,"PidI":0.0006,"PidIStateMax":0.6,"PidIStateMin":0,"PidP":0.047,"_compoundName":"control"},"conversion":{"Beta":3960,"MaxTemp":300,"MinTemp":10,"R0":100000,"ResistorR":4700,"_compoundName":"conversion"},"observer":{"ObserverInterval":0.5,"ObserverMinTime":5,"ObserverTolerance":5,"_compoundName":"observer"},"pwm_output":"FET5 (extruder 2)"}],"name":"RADDS example","probe":{"FastSpeed":2,"InvertInput":false,"LowHeight":2,"MoveSpeed":120,"OffsetX":-18,"OffsetY":-31,"ProbePin":"Z-MAX","ProbePoints":[{"X":0,"Y":31,"_compoundName":"ProbePoint"},{"X":0,"Y":155,"_compoundName":"ProbePoint"},{"X":205,"Y":31,"_compoundName":"ProbePoint"},{"X":205,"Y":155,"_compoundName":"ProbePoint"}],"RetractDist":1,"RetractSpeed":3,"SlowSpeed":0.6,"StartHeight":9,"_compoundName":"Probe"},"steppers":[{"CorneringDistance":40,"DistanceFactor":1,"EnableCartesianSpeedLimit":true,"InvertDir":false,"MaxAccel":1500,"MaxPos":210,"MaxSpeed":300,"MinPos":-53,"Name":"X","StepsPerUnit":160,"_compoundName":"stepper","homing":{"HomeDir":false,"HomeEndInvert":false,"HomeEndstopInput":"X-MIN","HomeFastMaxDist":280,"HomeFastSpeed":40,"HomeRetractDist":3,"HomeRetractSpeed":50,"HomeSlowMaxDist":5,"HomeSlowSpeed":5,"_compoundName":"homing"},"stepper_port":"X"},{"CorneringDistance":40,"DistanceFactor":1,"EnableCartesianSpeedLimit":true,"InvertDir":false,"MaxAccel":650,"MaxPos":157,"MaxSpeed":300,"MinPos":0,"Name":"Y","StepsPerUnit":160,"_compoundName":"stepper","homing":{"HomeDir":false,"HomeEndInvert":false,"HomeEndstopInput":"Y-MIN","HomeFastMaxDist":200,"HomeFastSpeed":40,"HomeRetractDist":3,"HomeRetractSpeed":50,"HomeSlowMaxDist":5,"HomeSlowSpeed":5,"_compoundName":"homing"},"stepper_port":"Y"},{"CorneringDistance":40,"DistanceFactor":1,"EnableCartesianSpeedLimit":true,"InvertDir":true,"MaxAccel":30,"MaxPos":100,"MaxSpeed":3,"MinPos":0,"Name":"Z","StepsPerUnit":8000,"_compoundName":"stepper","homing":{"HomeDir":false,"HomeEndInvert":false,"HomeEndstopInput":"Z-MIN","HomeFastMaxDist":101,"HomeFastSpeed":2,"HomeRetractDist":0.8,"HomeRetractSpeed":2,"HomeSlowMaxDist":1.2,"HomeSlowSpeed":0.6,"_compoundName":"homing"},"stepper_port":"Z"},{"CorneringDistance":40,"DistanceFactor":1,"EnableCartesianSpeedLimit":false,"InvertDir":false,"MaxAccel":250,"MaxPos":40000,"MaxSpeed":45,"MinPos":-40000,"Name":"E","StepsPerUnit":1856,"_compoundName":"stepper","homing":{"_compoundName":"no_homing"},"stepper_port":"E1"},{"CorneringDistance":40,"DistanceFactor":1,"EnableCartesianSpeedLimit":false,"InvertDir":false,"MaxAccel":250,"MaxPos":40000,"MaxSpeed":45,"MinPos":-40000,"Name":"U","StepsPerUnit":1320,"_compoundName":"stepper","homing":{"_compoundName":"no_homing"},"stepper_port":"E2"}]},{"InactiveTime":480,"_compoundName":"config","advanced":{"ForceTimeout":0.1,"LedBlinkInterval":0.5,"_compoundName":"advanced"},"board_id":"teensy3","fans":[{"Name":"E","OffMCommand":107,"SetMCommand":106,"_compoundName":"fan","pwm_output":"Fan"}],"heaters":[{"MaxSafeTemp":280,"MinSafeTemp":15,"Name":"T","SetMCommand":104,"ThermistorInput":"T","WaitMCommand":109,"_compoundName":"heater","control":{"ControlInterval":0.2,"PidD":0.17,"PidDHistory":0.7,"PidI":0.0006,"PidIStateMax":0.6,"PidIStateMin":0,"PidP":0.047,"_compoundName":"control"},"conversion":{"Beta":3960,"MaxTemp":300,"MinTemp":10,"R0":100000,"ResistorR":4700,"_compoundName":"conversion"},"observer":{"ObserverInterval":0.5,"ObserverMinTime":3,"ObserverTolerance":3,"_compoundName":"observer"},"pwm_output":"Extruder"}],"name":"Teensy 3 example","probe":{"_compoundName":"NoProbe"},"steppers":[{"CorneringDistance":40,"DistanceFactor":1,"EnableCartesianSpeedLimit":true,"InvertDir":false,"MaxAccel":1500,"MaxPos":200,"MaxSpeed":300,"MinPos":0,"Name":"X","StepsPerUnit":160,"_compoundName":"stepper","homing":{"HomeDir":false,"HomeEndInvert":false,"HomeEndstopInput":"X-min","HomeFastMaxDist":5,"HomeFastSpeed":50,"HomeRetractDist":3,"HomeRetractSpeed":50,"HomeSlowMaxDist":5,"HomeSlowSpeed":5,"_compoundName":"homing"},"stepper_port":"X"},{"CorneringDistance":40,"DistanceFactor":1,"EnableCartesianSpeedLimit":true,"InvertDir":false,"MaxAccel":1500,"MaxPos":200,"MaxSpeed":300,"MinPos":0,"Name":"Y","StepsPerUnit":160,"_compoundName":"stepper","homing":{"HomeDir":false,"HomeEndInvert":false,"HomeEndstopInput":"Y-min","HomeFastMaxDist":5,"HomeFastSpeed":50,"HomeRetractDist":3,"HomeRetractSpeed":50,"HomeSlowMaxDist":5,"HomeSlowSpeed":5,"_compoundName":"homing"},"stepper_port":"Y"},{"CorneringDistance":40,"DistanceFactor":1,"EnableCartesianSpeedLimit":true,"InvertDir":false,"MaxAccel":30,"MaxPos":100,"MaxSpeed":3,"MinPos":0,"Name":"Z","StepsPerUnit":8000,"_compoundName":"stepper","homing":{"HomeDir":false,"HomeEndInvert":false,"HomeEndstopInput":"Z-min","HomeFastMaxDist":101,"HomeFastSpeed":2,"HomeRetractDist":1,"HomeRetractSpeed":2,"HomeSlowMaxDist":1.5,"HomeSlowSpeed":0.5,"_compoundName":"homing"},"stepper_port":"Z"},{"CorneringDistance":40,"DistanceFactor":1,"EnableCartesianSpeedLimit":false,"InvertDir":false,"MaxAccel":250,"MaxPos":40000,"MaxSpeed":40,"MinPos":-40000,"Name":"E","StepsPerUnit":1856,"_compoundName":"stepper","homing":{"_compoundName":"no_homing"},"stepper_port":"E"}]}],"selected_config":"RADDS example","version":1};

// Divs/textareas on the page
var $editor = document.getElementById('editor');

// Buttons and other stuff
var $save_data_button = document.getElementById('save_data');
var $reload_data_button = document.getElementById('reload_data');
var $delete_saved_data_button = document.getElementById('delete_saved_data');
var $load_defaults_button = document.getElementById('load_defaults');
var $export_data_button = document.getElementById('export_data');
var $import_data_button = document.getElementById('import_data');
var $import_data_file_input = document.getElementById('import_data_file');
var $compile_start_button = document.getElementById('compile_start');

// Global variables.
var jsoneditor;

function ce_refarr(obj, attrs) {
    var len = attrs.length;
    for (var i = 0; i < len; i++) {
        obj = obj[attrs[i]];
        if (obj === null || typeof obj !== 'object') {
            return [];
        }
    }
    return obj;
}

function ce_deref(target_arr, target_id_field, target_id) {
    for (var index in target_arr) {
        var target = target_arr[index];
        if (target[target_id_field] == target_id) {
            return target;
        }
    }
    return null;
}

// Function to get config from local storage or default.
function get_config(allow_default) {
    var config_json = localStorage.getItem("aprinter_config");
    if (!config_json) {
        if (allow_default) {
            return {ok: true, value: default_config};
        }
        return {ok: false};
    }
    var config_value = JSON.parse(config_json);
    return {ok: true, value: config_value};
}

function set_compile_status(running) {
    $compile_start_button.disabled = running;
    
    var elems = document.getElementsByClassName("compile_progress");
    for (var i = 0; i < elems.length; i++) {
        elems[i].style.visibility = running ? "visible" : "hidden";
    }
}

function get_string_value() {
    return JSON.stringify(jsoneditor.getFinalValue());
}

function get_pretty_string_value() {
    return JSON.stringify(jsoneditor.getFinalValue(), undefined, 2);
}

function base64_to_blob(input, content_type) {
    var str = window.atob(input);
    var ab = new ArrayBuffer(str.length);
    var ia = new Uint8Array(ab);
    for (var i = 0; i < str.length; i++) {
        ia[i] = str.charCodeAt(i);
    }
    return new Blob([ia], {type: content_type});
}

var load = function() {
    // Get initial configuration from local storage, if any.
    var startval = get_config(true).value;

    // Create the editor.
    jsoneditor = new JSONEditor($editor, {
        schema: schema,
        startval: startval,
        disable_edit_json: true,
        disable_properties: true,
        required_by_default: true,
        template: "javascript",
        theme: "bootstrap3",
        iconlib: "bootstrap3"
    });
    
    // When the save button is pressed, save the config data to local storage.
    $save_data_button.addEventListener('click', function() {
        var config_json = get_string_value();
        localStorage.setItem("aprinter_config", config_json);
    });
    
    // When the reload button is pressed, load the config data from local storage.
    $reload_data_button.addEventListener('click', function() {
        var get_config_res = get_config(false);
        if (!get_config_res.ok) {
            alert("Cannot load - no configuration present in local storage!");
            return;
        }
        jsoneditor.setValue(get_config_res.value);
    });
    
    // Handler for the delete-saved-data button.
    $delete_saved_data_button.addEventListener('click', function() {
        localStorage.removeItem("aprinter_config");
    });
    
    // When the load-defaults button is pressed, load the default config.
    $load_defaults_button.addEventListener('click', function() {
        jsoneditor.setValue(default_config);
    });
    
    // If the window is about to be closed with unsaved data, ask for confirmation.
    window.onbeforeunload = function (evt) {
        if (JSON.stringify(get_config(true).value) == get_string_value()) {
            return null;
        }
        var message = 'APrinter Configuration: There are unsaved configuration changes!';
        if (typeof evt == 'undefined') {
            evt = window.event;
        }
        if (evt) {
            evt.returnValue = message;
        }
        return message;
    }
    
    // When the export button is pressed, trigger downloading of the configuration dump.
    $export_data_button.addEventListener('click', function() {
        var config_json = get_pretty_string_value();
        var blob = new Blob([config_json], {type: 'application/json;charset=utf-8'});
        saveAs(blob, 'aprinter_config.json')
    });
    
    // Import button handler.
    $import_data_button.addEventListener('click', function() {
        if (!$import_data_file_input.files[0]) {
            alert('Please select a configuration file to import.');
            return;
        }
        var reader = new FileReader();
        reader.onload = function() {
            var config = JSON.parse(this.result);
            jsoneditor.setValue(config);
        }
        reader.readAsText($import_data_file_input.files[0]);
    });
    
    // Compile button handler.
    $compile_start_button.addEventListener('click', function() {
        var compile_request = new XMLHttpRequest();
        compile_request.open("POST", "/compile", true);
        compile_request.setRequestHeader("Content-type", "application/json; charset=utf-8")
        
        compile_request.onreadystatechange = function() {
            if (compile_request.readyState == 4) {
                set_compile_status(false);
                
                if (compile_request.status != 200) {
                    alert("Compilation failed (request error)!");
                } else {
                    var result = JSON.parse(compile_request.responseText);
                    if (!result.success) {
                        alert("Compilation failed: " + result.message);
                    } else {
                        var blob = base64_to_blob(result.data, 'application/octet-stream');
                        saveAs(blob, result.filename)
                    }
                }
            }
        }
        
        compile_request.send(get_string_value());
        set_compile_status(true);
    });
}

load();
